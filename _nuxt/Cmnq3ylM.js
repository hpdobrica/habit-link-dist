import{_ as ee}from"./HnuN2Z5o.js";import{_ as te}from"./CEd7Nx2O.js";import{m as B,r as p,g as ae,o as n,c as i,x as h,a as e,N as b,R as F,W as P,d as C,X as I,_ as O,U as oe,B as re,J as _,F as D,u as E,b as $,t as N,w as se,v as ne}from"./XoIZNSvU.js";import{u as ie,a as le,g as ue}from"./BWebNu4v.js";import"./ByPNV1YK.js";import"./Cb9qwsxW.js";const de={key:1,class:"modal"},ce={class:"modal-controls"},pe={class:"form-group"},ve={class:"form-group"},ge={class:"form-group"},me={class:"form-group"},be={class:"target-selection"},fe=["disabled"],ye=B({__name:"createHabitModal",emits:["selectionMade"],setup(M,{expose:u,emit:H}){const t=p({icon:"",title:"",isTracked:!0,targetType:"completions",targetValue:0}),c=p(!1),v=H;function x(){if(t.value.icon==""||t.value.title==""||t.value.targetValue==0){alert("Please fill out all fields.");return}const d={icon:t.value.icon,title:t.value.title,isTracked:t.value.isTracked,targetDurationSec:t.value.targetType==="duration"?t.value.targetValue:0,targetCompletions:t.value.targetType==="completions"?t.value.targetValue:0};v("selectionMade",d),f(),k()}function f(){t.value={icon:"",title:"",isTracked:!0,targetType:"completions",targetValue:0}}ae(()=>t.value.isTracked,d=>{d||(t.value.targetType="duration")});function y(){c.value=!0}function k(){c.value=!1}return u({openModal:y,closeModal:k}),(d,a)=>(n(),i("div",null,[c.value?(n(),i("div",{key:0,class:"modal-overlay",onClick:k})):h("",!0),c.value?(n(),i("div",de,[a[13]||(a[13]=e("h2",{class:"modal-title"},"Create a New Habit",-1)),e("div",ce,[e("div",pe,[a[7]||(a[7]=e("label",{for:"habit-icon"},"Icon (Emoji):",-1)),b(e("input",{id:"habit-icon",type:"text","onUpdate:modelValue":a[0]||(a[0]=o=>t.value.icon=o),placeholder:"e.g., ðŸ’ª"},null,512),[[F,t.value.icon]])]),e("div",ve,[a[8]||(a[8]=e("label",{for:"habit-title"},"Title:",-1)),b(e("input",{id:"habit-title",type:"text","onUpdate:modelValue":a[1]||(a[1]=o=>t.value.title=o),placeholder:"Habit title"},null,512),[[F,t.value.title]])]),e("div",ge,[e("label",null,[b(e("input",{type:"checkbox","onUpdate:modelValue":a[2]||(a[2]=o=>t.value.isTracked=o)},null,512),[[P,t.value.isTracked]]),a[9]||(a[9]=C(" Track this habit "))])]),e("div",me,[a[12]||(a[12]=e("label",null,"Target:",-1)),e("div",be,[b(e("input",{type:"radio",value:"completions","onUpdate:modelValue":a[3]||(a[3]=o=>t.value.targetType=o),disabled:!t.value.isTracked},null,8,fe),[[I,t.value.targetType]]),a[10]||(a[10]=e("label",null," Number of Completions ",-1)),b(e("input",{type:"radio",value:"duration","onUpdate:modelValue":a[4]||(a[4]=o=>t.value.targetType=o)},null,512),[[I,t.value.targetType]]),a[11]||(a[11]=e("label",null," Duration (Seconds) ",-1))]),t.value.targetType==="completions"?b((n(),i("input",{key:0,type:"number","onUpdate:modelValue":a[5]||(a[5]=o=>t.value.targetValue=o),placeholder:"Enter number of completions"},null,512)),[[F,t.value.targetValue]]):h("",!0),t.value.targetType==="duration"?b((n(),i("input",{key:1,type:"number","onUpdate:modelValue":a[6]||(a[6]=o=>t.value.targetValue=o),placeholder:"Enter duration in seconds"},null,512)),[[F,t.value.targetValue]]):h("",!0)])]),e("button",{class:"submit-button",onClick:x},"Create Habit")])):h("",!0)]))}}),ke=O(ye,[["__scopeId","data-v-33fe82d7"]]),Te={key:1,class:"modal"},_e={class:"modal-controls"},he=B({__name:"filterHabitModal",props:{archived:Boolean,nonTracked:Boolean},emits:["filtersApplied"],setup(M,{expose:u,emit:H}){const t=M,c=p(!1),v=p(t.archived),x=p(t.nonTracked),f=H;function y(){f("filtersApplied",{archived:v.value,nonTracked:x.value}),d()}function k(){c.value=!0}function d(){c.value=!1}return u({openModal:k,closeModal:d}),(a,o)=>(n(),i("div",null,[c.value?(n(),i("div",{key:0,class:"modal-overlay",onClick:d})):h("",!0),c.value?(n(),i("div",Te,[o[4]||(o[4]=e("h2",{class:"modal-title"},"Filter Habits",-1)),e("div",_e,[e("label",null,[b(e("input",{type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=V=>v.value=V)},null,512),[[P,v.value]]),o[2]||(o[2]=C(" Archived "))]),e("label",null,[b(e("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=V=>x.value=V)},null,512),[[P,x.value]]),o[3]||(o[3]=C(" Non-tracked "))])]),e("button",{class:"submit-button",onClick:y},"Apply Filters")])):h("",!0)]))}}),Me=O(he,[["__scopeId","data-v-8a677938"]]);async function xe(){return!navigator.storage||!navigator.storage.persisted?!1:navigator.storage.persisted()}async function q(){return console.log("trying to persist storage"),!navigator.storage||!navigator.storage.persisted?(console.log("persistence features not available"),!1):navigator.storage.persist()}async function L(){if(!navigator.storage||!navigator.storage.persisted)return"never";let M=await xe();if(M)return"persisted";if(!navigator.permissions||!navigator.permissions.query)return"prompt";try{const u=await navigator.permissions.query({name:"persistent-storage"});if(u.state==="granted"){if(M=await q(),M)return"persisted";throw new Error("Failed to persist")}if(u.state==="prompt")return"prompt"}catch(u){return console.error("Failed to check or request permission to use persistent storage",u),"prompt"}return"never"}const Ve={class:"habit-tracker"},we={key:0,class:"persistence-warning"},He={class:"habits"},Ce={class:"date-heading weekday"},Se={key:1},Fe={class:"habit-info"},De={class:"habit-icon"},Be=B({__name:"index",async setup(M){let u,H,t=p(([u,H]=oe(()=>L()),u=await u,H(),u));const c=async()=>{await q()||alert("The browser you are using is not supporting persistence, or you have disabled it. Please enable it to use this feature."),t.value=await L()},v=ie(),x=v.habitsLoading,f=p(!1),y=p(!1),k=re(()=>Object.fromEntries(Object.entries(v.habits.value).filter(([s,r])=>!f.value&&!r.isTracked?(console.log("Filtered out (NonTracked)",r,f.value,r.isTracked),!1):!y.value&&r.archived==1?(console.log("Filtered out (Archived)",r,y.value,r.archived),!1):!0))),d=new Date,a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],o=le();function V(s,r){const g=new Date(s);return g.setDate(g.getDate()-r),g}const U=p(null),A=p(null);function R(){U.value?U.value.openModal():console.error("CreateHabitModal is not available yet.")}function W(){A.value?A.value.openModal():console.error("FilterHabitModal is not available yet.")}const z=s=>{v.addHabit(s.icon,s.title,s.targetDurationSec,s.targetCompletions,s.isTracked)},J=s=>{console.log(s),f.value=s.nonTracked,y.value=s.archived};function X(s,r){const g=k.value[s],S=g.targetDurationSec?"duration":"completions",l=ue(V(d,r)),m=S==="duration"?g.targetDurationSec:g.targetCompletions;let T=0;if(S==="duration"?T=Object.values(o.habitLogs.value).filter(w=>w.habitId===s&&w.date===l).reduce((w,Z)=>w+Z.durationSec,0):T=Object.values(o.habitLogs.value).filter(w=>w.habitId===s&&w.date===l).length,T===0)return{background:"#ccc"};const G=Math.min(T/m*100,100),j=Math.round(255*G/100),K=`rgb(${255-j}, 255, ${255-j})`,Q=T>=m?"0 0 10px 2px rgba(0, 255, 0, 0.5)":"none",Y=T>=m?"none":"1px solid #ddd";return{background:K,boxShadow:Q,border:Y}}return(s,r)=>{const g=ee,S=te;return n(),i(D,null,[e("div",Ve,[e("div",{class:"header"},[r[1]||(r[1]=e("h1",null,"Habits",-1)),e("div",{class:"actions"},[e("button",{class:"create",onClick:R},"+"),e("button",{class:"filter",onClick:W},"â˜°")])]),_(t)!="persisted"?(n(),i("div",we,[r[2]||(r[2]=C(" âš ï¸ Using best-effort storage ")),_(t)!="never"?(n(),i("button",{key:0,class:"fix-button",onClick:r[0]||(r[0]=l=>c())},"Fix")):h("",!0)])):h("",!0),e("div",He,[r[4]||(r[4]=e("div",{class:"habit-info"},null,-1)),(n(!0),i(D,null,E(Array.from({length:6},(l,m)=>m),l=>(n(),i("div",{class:"date-heading",key:l},[C(N(V(_(d),l).getDate()),1),r[3]||(r[3]=e("br",null,null,-1)),e("span",Ce,N(a[V(_(d),l).getDay()]),1)]))),128))]),_(x)?(n(),i("div",Se,"Loading...")):(n(!0),i(D,{key:2},E(_(k),l=>(n(),i("div",{class:"habits",key:l.id},[e("div",Fe,[e("div",De,N(l.icon),1),$(g,{to:{name:"habits-id",params:{id:l.id}},class:"habit-name"},{default:se(()=>[C(N(l.title),1)]),_:2},1032,["to"])]),(n(!0),i(D,null,E(Array.from({length:6},(m,T)=>T),m=>(n(),i("div",{class:"day-entry",style:ne(X(l.id,m)),key:m},null,4))),128))]))),128))]),$(ke,{ref_key:"createHabitModal",ref:U,onSelectionMade:z},null,512),$(Me,{ref_key:"filterHabitModal",ref:A,archived:_(y),"non-tracked":_(f),onFiltersApplied:J},null,8,["archived","non-tracked"]),$(S)],64)}}});export{Be as default};
