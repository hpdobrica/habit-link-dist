import{_ as Oe}from"./D4ey3_w1.js";import{e as Me,r as M,v as B,i as Ye,g as Fe,B as Ue,o as H,y as Ce,w as me,p as xe,G as $e,aE as Ve,H as We,n as Te,O as je,P as ee,C as Ne,E as r,c as K,a as y,b as Ke,t as k,q as ze,m as Ge,Q as z,d as qe}from"./BytMB3SF.js";import{a as be}from"./G5D3odbm.js";import{H as ve}from"./Cb9qwsxW.js";import{u as Qe}from"./BE8AINAi.js";import{u as Xe,a as Je}from"./C0zp1LJB.js";import"./Bf9W53Ko.js";const Ze=window.setInterval;var ie=1,q=2,Q=4,X=8,J=16,Ee=32,te=64,oe=128,Se=256,ye=512,ge=1024,Ae=oe|te|J|X|Q|q,S=1e3,w=60,L=60,_=24,we=_*L*w*S,I=7,P=12,O=10,Y=10,F=10,G=Math.ceil,D=Math.floor;function Re(e,a){var n=e.getTime();return e.setMonth(e.getMonth()+a),Math.round((e.getTime()-n)/we)}function he(e){var a=e.getTime(),n=new Date(a);return n.setMonth(e.getMonth()+1),Math.round((n.getTime()-a)/we)}function en(e){var a=e.getTime(),n=new Date(a);return n.setFullYear(e.getFullYear()+1),Math.round((n.getTime()-a)/we)}function pe(e,a){if(a=a instanceof Date||a!==null&&isFinite(a)?new Date(+a):new Date,!e)return a;var n=+e.value||0;return n?(a.setTime(a.getTime()+n),a):(n=+e.milliseconds||0,n&&a.setMilliseconds(a.getMilliseconds()+n),n=+e.seconds||0,n&&a.setSeconds(a.getSeconds()+n),n=+e.minutes||0,n&&a.setMinutes(a.getMinutes()+n),n=+e.hours||0,n&&a.setHours(a.getHours()+n),n=+e.weeks||0,n&&(n*=I),n+=+e.days||0,n&&a.setDate(a.getDate()+n),n=+e.months||0,n&&a.setMonth(a.getMonth()+n),n=+e.millennia||0,n&&(n*=F),n+=+e.centuries||0,n&&(n*=Y),n+=+e.decades||0,n&&(n*=O),n+=+e.years||0,n&&a.setFullYear(a.getFullYear()+n),a)}var ke=0,nn=1,an=2,tn=3,on=4,un=5,rn=6,ln=7,sn=8,cn=9,He=10,ne,ae,ue,re,le,g,Ie;function fn(e,a){return Ie(e)+(e===1?ne[a]:ae[a])}var Le;function V(){}V.prototype.toString=function(e){var a=Le(this),n=a.length;if(!n)return e?""+e:le;if(n===1)return a[0];var t=ue+a.pop();return a.join(re)+t};V.prototype.toHTML=function(e,a){e=e||"span";var n=Le(this),t=n.length;if(!t)return a=a||le,a&&"<"+e+">"+a+"</"+e+">";for(var i=0;i<t;i++)n[i]="<"+e+">"+n[i]+"</"+e+">";if(t===1)return n[0];var u=ue+n.pop();return n.join(re)+u};V.prototype.addTo=function(e){return pe(this,e)};Le=function(e){var a=[],n=e.millennia;return n&&a.push(g(n,He)),n=e.centuries,n&&a.push(g(n,cn)),n=e.decades,n&&a.push(g(n,sn)),n=e.years,n&&a.push(g(n,ln)),n=e.months,n&&a.push(g(n,rn)),n=e.weeks,n&&a.push(g(n,un)),n=e.days,n&&a.push(g(n,on)),n=e.hours,n&&a.push(g(n,tn)),n=e.minutes,n&&a.push(g(n,an)),n=e.seconds,n&&a.push(g(n,nn)),n=e.milliseconds,n&&a.push(g(n,ke)),a};function dn(e,a){switch(a){case"seconds":if(e.seconds!==w||isNaN(e.minutes))return;e.minutes++,e.seconds=0;case"minutes":if(e.minutes!==L||isNaN(e.hours))return;e.hours++,e.minutes=0;case"hours":if(e.hours!==_||isNaN(e.days))return;e.days++,e.hours=0;case"days":if(e.days!==I||isNaN(e.weeks))return;e.weeks++,e.days=0;case"weeks":if(e.weeks!==he(e.refMonth)/I||isNaN(e.months))return;e.months++,e.weeks=0;case"months":if(e.months!==P||isNaN(e.years))return;e.years++,e.months=0;case"years":if(e.years!==O||isNaN(e.decades))return;e.decades++,e.years=0;case"decades":if(e.decades!==Y||isNaN(e.centuries))return;e.centuries++,e.decades=0;case"centuries":if(e.centuries!==F||isNaN(e.millennia))return;e.millennia++,e.centuries=0}}function N(e,a,n,t,i,u){return e[n]>=0&&(a+=e[n],delete e[n]),a/=i,a+1<=1?0:e[t]>=0?(e[t]=+(e[t]+a).toFixed(u),dn(e,t),0):a}function vn(e,a){var n=N(e,0,"milliseconds","seconds",S,a);if(n&&(n=N(e,n,"seconds","minutes",w,a),!!n&&(n=N(e,n,"minutes","hours",L,a),!!n&&(n=N(e,n,"hours","days",_,a),!!n&&(n=N(e,n,"days","weeks",I,a),!!n&&(n=N(e,n,"weeks","months",he(e.refMonth)/I,a),!!n&&(n=N(e,n,"months","years",en(e.refMonth)/he(e.refMonth),a),!!n&&(n=N(e,n,"years","decades",O,a),!!n&&(n=N(e,n,"decades","centuries",Y,a),!!n&&(n=N(e,n,"centuries","millennia",F,a),n))))))))))throw new Error("Fractional unit overflow")}function mn(e){var a;for(e.milliseconds<0?(a=G(-e.milliseconds/S),e.seconds-=a,e.milliseconds+=a*S):e.milliseconds>=S&&(e.seconds+=D(e.milliseconds/S),e.milliseconds%=S),e.seconds<0?(a=G(-e.seconds/w),e.minutes-=a,e.seconds+=a*w):e.seconds>=w&&(e.minutes+=D(e.seconds/w),e.seconds%=w),e.minutes<0?(a=G(-e.minutes/L),e.hours-=a,e.minutes+=a*L):e.minutes>=L&&(e.hours+=D(e.minutes/L),e.minutes%=L),e.hours<0?(a=G(-e.hours/_),e.days-=a,e.hours+=a*_):e.hours>=_&&(e.days+=D(e.hours/_),e.hours%=_);e.days<0;)e.months--,e.days+=Re(e.refMonth,1);e.days>=I&&(e.weeks+=D(e.days/I),e.days%=I),e.months<0?(a=G(-e.months/P),e.years-=a,e.months+=a*P):e.months>=P&&(e.years+=D(e.months/P),e.months%=P),e.years>=O&&(e.decades+=D(e.years/O),e.years%=O,e.decades>=Y&&(e.centuries+=D(e.decades/Y),e.decades%=Y,e.centuries>=F&&(e.millennia+=D(e.centuries/F),e.centuries%=F)))}function hn(e,a,n,t){var i=0;!(a&ge)||i>=n?(e.centuries+=e.millennia*F,delete e.millennia):e.millennia&&i++,!(a&ye)||i>=n?(e.decades+=e.centuries*Y,delete e.centuries):e.centuries&&i++,!(a&Se)||i>=n?(e.years+=e.decades*O,delete e.decades):e.decades&&i++,!(a&oe)||i>=n?(e.months+=e.years*P,delete e.years):e.years&&i++,!(a&te)||i>=n?(e.months&&(e.days+=Re(e.refMonth,e.months)),delete e.months,e.days>=I&&(e.weeks+=D(e.days/I),e.days%=I)):e.months&&i++,!(a&Ee)||i>=n?(e.days+=e.weeks*I,delete e.weeks):e.weeks&&i++,!(a&J)||i>=n?(e.hours+=e.days*_,delete e.days):e.days&&i++,!(a&X)||i>=n?(e.minutes+=e.hours*L,delete e.hours):e.hours&&i++,!(a&Q)||i>=n?(e.seconds+=e.minutes*w,delete e.minutes):e.minutes&&i++,!(a&q)||i>=n?(e.milliseconds+=e.seconds*S,delete e.seconds):e.seconds&&i++,(!(a&ie)||i>=n)&&vn(e,t)}function De(e,a,n,t,i,u){var h=new Date;if(e.start=a=a||h,e.end=n=n||h,e.units=t,e.value=n.getTime()-a.getTime(),e.value<0){var f=n;n=a,a=f}e.refMonth=new Date(a.getFullYear(),a.getMonth(),15,12,0,0);try{e.millennia=0,e.centuries=0,e.decades=0,e.years=n.getFullYear()-a.getFullYear(),e.months=n.getMonth()-a.getMonth(),e.weeks=0,e.days=n.getDate()-a.getDate(),e.hours=n.getHours()-a.getHours(),e.minutes=n.getMinutes()-a.getMinutes(),e.seconds=n.getSeconds()-a.getSeconds(),e.milliseconds=n.getMilliseconds()-a.getMilliseconds(),mn(e),hn(e,t,i,u)}finally{delete e.refMonth}return e}function pn(e){return e&ie?S/30:e&q?S:e&Q?S*w:e&X?S*w*L:e&J?S*w*L*_:S*w*L*_*I}function l(e,a,n,t,i){var u;n=+n||Ae,t=t>0?t:NaN,i=i>0?i<20?Math.round(i):20:0;var h=null;typeof e=="function"?(u=e,e=null):e instanceof Date||(e!==null&&isFinite(e)?e=new Date(+e):(typeof h=="object"&&(h=e),e=null));var f=null;if(typeof a=="function"?(u=a,a=null):a instanceof Date||(a!==null&&isFinite(a)?a=new Date(+a):(typeof a=="object"&&(f=a),a=null)),h&&(e=pe(h,a)),f&&(a=pe(f,e)),!e&&!a)return new V;if(!u)return De(new V,e,a,n,t,i);var v=pn(n),o,p=function(){u(De(new V,e,a,n,t,i),o)};return p(),o=Ze(p,v)}l.MILLISECONDS=ie;l.SECONDS=q;l.MINUTES=Q;l.HOURS=X;l.DAYS=J;l.WEEKS=Ee;l.MONTHS=te;l.YEARS=oe;l.DECADES=Se;l.CENTURIES=ye;l.MILLENNIA=ge;l.DEFAULTS=Ae;l.ALL=ge|ye|Se|oe|te|Ee|J|X|Q|q|ie;var En=l.setFormat=function(e){if(e){if("singular"in e||"plural"in e){var a=e.singular||[];a.split&&(a=a.split("|"));var n=e.plural||[];n.split&&(n=n.split("|"));for(var t=ke;t<=He;t++)ne[t]=a[t]||ne[t],ae[t]=n[t]||ae[t]}typeof e.last=="string"&&(ue=e.last),typeof e.delim=="string"&&(re=e.delim),typeof e.empty=="string"&&(le=e.empty),typeof e.formatNumber=="function"&&(Ie=e.formatNumber),typeof e.formatter=="function"&&(g=e.formatter)}},Pe=l.resetFormat=function(){ne=" millisecond| second| minute| hour| day| week| month| year| decade| century| millennium".split("|"),ae=" milliseconds| seconds| minutes| hours| days| weeks| months| years| decades| centuries| millennia".split("|"),ue=" and ",re=", ",le="",Ie=function(e){return e},g=fn};l.setLabels=function(e,a,n,t,i,u,h){En({singular:e,plural:a,last:n,delim:t,empty:i,formatNumber:u,formatter:h})};l.resetLabels=Pe;Pe();const Sn=()=>be("timer-cache",()=>({})),yn=Me({__name:"countdown",props:{tag:{type:String,default:"div"},transform:{type:Function,default:e=>e},date:{type:Date,default:null,validator:e=>e.getTime()>=0},timerCacheId:{type:String,default:null},autoStart:{type:Boolean,default:!0},autoComplete:{type:Boolean,default:!1}},emits:["complete"],setup(e,{expose:a,emit:n}){const t=Sn(),i=e;let u=null;const h=M({minutes:0,seconds:0}),f=M(Date.now()),v=M(0),o=M(null),p=M(null),E=M(null),se=n,c=M(!1);function U(){E.value!==null&&(u=l(T=>{h.value=T,T.minutes===0&&T.seconds===0&&!c.value&&(c.value=!0,se("complete"))},new Date(E.value),l.MINUTES|l.SECONDS,2))}function C(){o.value||(o.value=Date.now(),u!==null&&(clearInterval(u),u=null),E.value!==null&&(p.value=E.value-Date.now()))}function s(){o.value&&(v.value+=Date.now()-o.value,o.value=null,p.value!==null&&(E.value=Date.now()+p.value,p.value=null,U()))}function A(){o.value?s():C()}const _e=B(()=>o.value?o.value-f.value-v.value:Date.now()-f.value-v.value),W=B(()=>o.value?v.value+(Date.now()-o.value):v.value),ce=B(()=>i.transform({timespan:h.value,activeTime:_e.value,pausedTime:W.value,pause:C,resume:s,togglePause:A})),fe=B(()=>!!o.value);function Z(){const T=Date.now();let x,j;return o.value?(x=o.value-f.value-v.value,j=v.value+(T-o.value)):(x=T-f.value-v.value,j=v.value),{activeTime:x,pausedTime:j}}return a({togglePause:A,pause:C,resume:s,getTimerValues:Z,isPaused:fe}),Ye(()=>{t.value.timerCacheId!==i.timerCacheId&&(t.value={timerCacheId:i.timerCacheId,startTime:void 0}),t.value.startTime?(f.value=t.value.startTime,v.value=t.value.pausedTime||v.value,o.value=t.value.pauseStart||o.value,p.value=t.value.remainingMs||p.value,E.value=t.value.endTime||E.value,c.value=t.value.hasEmittedCompletion||c.value,o.value&&p.value!==null?h.value=l(new Date(0),new Date(p.value),l.MINUTES|l.SECONDS,2):U()):(f.value=Date.now(),i.date&&(E.value=i.date.getTime()),U(),i.autoStart||C())}),Fe([f,v,o,p,E],()=>{if(t.value.timerCacheId!==i.timerCacheId){Te(()=>{t.value={timerCacheId:i.timerCacheId}});return}Te(()=>{t.value={timerCacheId:i.timerCacheId,startTime:f.value,pausedTime:v.value,pauseStart:o.value||void 0,remainingMs:p.value||void 0,endTime:E.value||void 0,hasEmittedCompletion:c.value}})},{deep:!0}),Ue(()=>{u!==null&&clearInterval(u)}),(T,x)=>(H(),Ce(We(e.tag),null,{default:me(()=>[xe(T.$slots,"default",$e(Ve(ce.value)))]),_:3}))}}),gn=()=>be("routine-run-cache",()=>({})),wn={key:0},In={key:1,class:"page"},Ln={class:"top-bar"},_n={class:"routine-title"},Tn={class:"timer-section"},Nn={class:"timer-icon"},Dn={class:"countdown-timer"},Mn={class:"total-duration"},Cn={class:"action-buttons"},bn={class:"action-buttons"},An={key:0},Rn={key:0,class:"next-habit-title"},kn={key:1,class:"next-habit-title"},xn=Me({__name:"run",async setup(e){let a,n;const t=je(),i=t.params.id;if(typeof i!="string")throw[a,n]=ee(()=>z("/")),await a,n(),new Error("wrong routine id");const u=t.params.routineLogId;if(typeof u!="string")throw[a,n]=ee(()=>z("/")),await a,n(),new Error("wrong routine log id");const h=Qe(),f=Xe(),v=Je(),o=gn(),p=h.routines,E=h.routinesLoading,se=f.habitsLoading,c=B(()=>p.value[i]??null);Ne(()=>{!E.value&&!p.value[i]&&(alert("routine not found, about to navigate to home, if this is a mistake try going back and report the issue!"),z("/"))});const U=(d=new Date)=>{c.value.habitInstances[s.value]!=null&&(A.value=new Date(d),A.value.setSeconds(A.value.getSeconds()+c.value.habitInstances[s.value].durationSec),o.value.RoutineLogId=u,o.value.CurrentIndex=s.value)},C=M(null),s=M(0);let A=M(new Date);if(Ne(()=>{!E.value&&c.value&&(o.value.RoutineLogId!=null&&o.value.RoutineLogId!=u&&(o.value={}),o.value.CurrentIndex!=null&&(s.value=o.value.CurrentIndex),U())}),!([a,n]=ee(()=>v.getRoutineLog(u)),a=await a,n(),a))throw[a,n]=ee(()=>z("/routines/"+i)),await a,n(),new Error("routine log not found");const W=async d=>{const m=C.value;if(m==null)return;const $=m.getTimerValues();v.createHabitLog(c.value.habitInstances[s.value].habitId,d,$.activeTime/1e3,u),await ce()||(s.value++,U())},ce=async()=>c.value.habitInstances.length<=s.value+1?(o.value={},await z(`/routines/${i}/logs/${u}/complete`),!0):!1,fe=()=>{const d=C.value;d!=null&&d.togglePause()},Z=B(()=>{const d=C.value;return d==null?!1:d.isPaused}),T=B(()=>!(c.value.habitInstances.length<=s.value+1)),x=d=>{const m={};let $=!1;d.timespan.value!=null&&($=d.timespan.value<0);const b=d.timespan.minutes||0,R=d.timespan.seconds||0,de=$?`+${b<10?`0${b}`:b}`:b<10?`0${b}`:String(b),Be=R<10?`0${R}`:String(R);return m.minutes=de,m.seconds=Be,m},j=async()=>{c.value.habitInstances[s.value].autoComplete&&await W(ve.Completed)};return(d,m)=>{const $=Oe,b=yn;return r(E)||r(se)?(H(),K("div",wn,"Loading...")):(H(),K("div",In,[y("div",Ln,[m[3]||(m[3]=y("div",{class:"placeholder"},null,-1)),Ke($,{to:{name:"routines-id",params:{id:r(c).id}},class:"close-button"},{default:me(()=>m[2]||(m[2]=[qe("X ")])),_:1},8,["to"])]),y("h1",_n,k(r(f).habits.value[r(c).habitInstances[r(s)].habitId].title),1),y("div",Tn,[y("div",Nn,k(r(f).habits.value[r(c).habitInstances[r(s)].habitId].icon),1),(H(),Ce(b,{date:r(A),transform:x,"allow-negative":!0,key:r(s),timerCacheId:r(u)+"-"+r(s),ref_key:"countdownTimer",ref:C,"auto-start":r(c).habitInstances[r(s)].autoStart,onComplete:j},{default:me(({minutes:R,seconds:de})=>[y("div",Dn,k(R)+":"+k(de),1)]),_:1},8,["date","timerCacheId","auto-start"])),y("div",Mn,k(r(c).habitInstances[r(s)].durationSec)+"s",1)]),y("div",Cn,[y("button",{class:ze(["action-button pause-button",{blinking:r(Z)}]),onClick:fe},k(r(Z)?"▶️":"⏸️"),3),y("button",{class:"action-button complete-button",onClick:m[0]||(m[0]=R=>W(("HabitStatus"in d?d.HabitStatus:r(ve)).Completed))},"✔️"),y("button",{class:"action-button skip-button",onClick:m[1]||(m[1]=R=>W(("HabitStatus"in d?d.HabitStatus:r(ve)).Skipped))},"⏭️")]),y("div",bn,[r(c).habitInstances[r(s)].autoComplete?(H(),K("h3",An,"will auto-complete ⏩")):Ge("",!0)]),r(T)?(H(),K("h3",Rn," Next habit ➡️ "+k(r(f).habits.value[r(c).habitInstances[r(s)+1].habitId].title),1)):(H(),K("h3",kn,"This is the last one! 🏆")),m[4]||(m[4]=y("div",{class:"footer"}," Additional details can go here. ",-1))]))}}});export{xn as default};
