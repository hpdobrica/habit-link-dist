import{_ as S}from"./BLxhTmIx.js";import{u as B,g as m}from"./DpP7iasV.js";import{m as T,D as V,E as H,G as C,e as A,r as F,C as t,c as n,a as i,b as R,w as G,t as l,F as O,u as X,x as E,H as v,o as r,d as Y}from"./Bdlf0Gjw.js";import{u as j}from"./BYfunqkF.js";import{u as q}from"./0OK1zX_s.js";import"./5hOz_2Hu.js";const z={key:0},J={key:1,class:"page"},K={class:"top-bar"},Q={class:"routine-title"},U={key:1},at=T({__name:"complete",async setup(W){let h,_;const y=V(),d=y.params.id,o=y.params.routineLogId;if(typeof d!="string")throw[h,_]=H(()=>v("/")),await h,_(),new Error("wrong routine id");const w=j(),L=q(),c=B(),M=w.routines,b=w.routinesLoading,x=C(()=>M.value[d]??null),u=c.habitLogs,s=c.routineLogs,p=c.statsLoading;A(()=>{!b.value&&!M.value[d]&&v("/"),!p.value&&!s.value[o]&&v("/"),!p.value&&s.value[o].routineId!==d&&v("/")});const D=new Date,a=new Date(D);a.setDate(a.getDate()-1);const k=F(!1),I=C(()=>{if(!(D.getHours()<4))return!1;if(s.value[o].date!==m(a))return!0;s.value[o].habitLogIds.forEach(e=>{if(u.value[e].date!==m(a))return!0})});async function N(){try{s.value[o].date!==m(a)&&await c.updateExecutionDates(o,m(a)),k.value=!0}catch(f){console.error("failed moving logs to previous day",f)}}return(f,e)=>{const P=S;return t(b)||t(p)?(r(),n("div",z,"Loading...")):(r(),n("div",J,[i("div",K,[e[1]||(e[1]=i("div",{class:"placeholder"},null,-1)),R(P,{to:{name:"routines-id",params:{id:t(x).id}},class:"close-button"},{default:G(()=>e[0]||(e[0]=[Y("X ")])),_:1},8,["to"])]),i("h1",Q,l(t(x).title)+" complete!",1),i("ul",null,[(r(!0),n(O,null,X(t(s)[t(o)].habitLogIds,g=>(r(),n("li",null,l(t(L).habits.value[t(u)[g].habitId].icon)+" "+l(t(L).habits.value[t(u)[g].habitId].title)+" "+l(Math.round(t(u)[g].durationSec))+"s "+l(t(u)[g].status),1))),256))]),e[2]||(e[2]=i("div",{style:{height:"20px"}},null,-1)),t(I)?(r(),n("button",{key:0,onClick:N,class:"move-to-previous-day"}," Oops, Past Midnight? Shift to Yesterday ")):E("",!0),t(k)?(r(),n("div",U,"âœ… Moved to previous day")):E("",!0),e[3]||(e[3]=i("div",{class:"footer"}," Additional details can go here. ",-1))]))}}});export{at as default};
