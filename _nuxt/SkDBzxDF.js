import{_ as N}from"./DHWvpWWS.js";import{u as B,a as T,g as h}from"./aKLh-avd.js";import{e as V,O as H,P as F,v as P,C as O,r as R,E as t,c as s,a,b as Q,w as X,t as l,F as Y,k as j,m as S,Q as p,o as n,d as q}from"./DMFZ8iid.js";import{u as z}from"./Du6vVzvj.js";import"./aB7QCl0n.js";import"./Cb9qwsxW.js";const G={key:0},J={key:1,class:"page"},K={class:"top-bar"},U={class:"routine-title"},W={key:1},nt=V({__name:"complete",async setup(Z){let _,y;const M=H(),c=M.params.id,o=M.params.routineLogId;if(typeof c!="string")throw[_,y]=F(()=>p("/")),await _,y(),new Error("wrong routine id");const w=z(),b=B(),g=T(),L=w.routines,k=w.routinesLoading,x=P(()=>L.value[c]??null),i=g.habitLogs,r=g.routineLogs,v=g.statsLoading;O(()=>{!k.value&&!L.value[c]&&p("/"),!v.value&&!r.value[o]&&p("/"),!v.value&&r.value[o].routineId!==c&&p("/")});const D=new Date,u=new Date(D);u.setDate(u.getDate()-1);const C=R(!1),I=()=>{const d=r.value[o].date!==h(u),e=r.value[o].habitLogIds.some(f=>i.value[f].date!==h(u));return d||e},A=P(()=>D.getHours()<4?I():!1);async function E(){try{I()&&await g.updateExecutionDates(o,h(u)),C.value=!0}catch(d){console.error("failed moving logs to previous day",d)}}return(d,e)=>{const f=N;return t(k)||t(v)?(n(),s("div",G,"Loading...")):(n(),s("div",J,[a("div",K,[e[1]||(e[1]=a("div",{class:"placeholder"},null,-1)),Q(f,{to:{name:"routines-id",params:{id:t(x).id}},class:"close-button"},{default:X(()=>e[0]||(e[0]=[q("X ")])),_:1},8,["to"])]),a("h1",U,l(t(x).title)+" complete!",1),a("ul",null,[(n(!0),s(Y,null,j(t(r)[t(o)].habitLogIds,m=>(n(),s("li",null,l(t(b).habits.value[t(i)[m].habitId].icon)+" "+l(t(b).habits.value[t(i)[m].habitId].title)+" "+l(Math.round(t(i)[m].durationSec))+"s "+l(t(i)[m].status),1))),256))]),e[2]||(e[2]=a("div",{style:{height:"20px"}},null,-1)),t(A)?(n(),s("button",{key:0,onClick:E,class:"move-to-previous-day"}," Oops, Past Midnight? Shift to Yesterday ")):S("",!0),t(C)?(n(),s("div",W,"âœ… Moved to previous day")):S("",!0),e[3]||(e[3]=a("div",{class:"footer"}," Additional details can go here. ",-1))]))}}});export{nt as default};
