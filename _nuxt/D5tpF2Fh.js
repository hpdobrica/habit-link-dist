import{_ as P}from"./CJ-lFzDM.js";import{u as B,g as h}from"./DBWOW9Zm.js";import{m as H,D as T,E as V,G as S,e as F,r as R,C as t,c as s,a,b as G,w as O,t as l,F as X,u as Y,x as A,H as p,o as n,d as j}from"./DSdxKxF8.js";import{u as q}from"./qvMWwfJ_.js";import{u as z}from"./DJWdCzLc.js";import"./5hOz_2Hu.js";const J={key:0},K={key:1,class:"page"},Q={class:"top-bar"},U={class:"routine-title"},W={key:1},nt=H({__name:"complete",async setup(Z){let _,y;const M=T(),c=M.params.id,o=M.params.routineLogId;if(typeof c!="string")throw[_,y]=V(()=>p("/")),await _,y(),new Error("wrong routine id");const w=q(),b=z(),g=B(),L=w.routines,x=w.routinesLoading,D=S(()=>L.value[c]??null),i=g.habitLogs,r=g.routineLogs,v=g.statsLoading;F(()=>{!x.value&&!L.value[c]&&p("/"),!v.value&&!r.value[o]&&p("/"),!v.value&&r.value[o].routineId!==c&&p("/")});const k=new Date,u=new Date(k);u.setDate(u.getDate()-1);const C=R(!1),I=()=>{const d=r.value[o].date!==h(u),e=r.value[o].habitLogIds.some(f=>i.value[f].date!==h(u));return d||e},E=S(()=>k.getHours()<4?I():!1);async function N(){try{I()&&await g.updateExecutionDates(o,h(u)),C.value=!0}catch(d){console.error("failed moving logs to previous day",d)}}return(d,e)=>{const f=P;return t(x)||t(v)?(n(),s("div",J,"Loading...")):(n(),s("div",K,[a("div",Q,[e[1]||(e[1]=a("div",{class:"placeholder"},null,-1)),G(f,{to:{name:"routines-id",params:{id:t(D).id}},class:"close-button"},{default:O(()=>e[0]||(e[0]=[j("X ")])),_:1},8,["to"])]),a("h1",U,l(t(D).title)+" complete!",1),a("ul",null,[(n(!0),s(X,null,Y(t(r)[t(o)].habitLogIds,m=>(n(),s("li",null,l(t(b).habits.value[t(i)[m].habitId].icon)+" "+l(t(b).habits.value[t(i)[m].habitId].title)+" "+l(Math.round(t(i)[m].durationSec))+"s "+l(t(i)[m].status),1))),256))]),e[2]||(e[2]=a("div",{style:{height:"20px"}},null,-1)),t(E)?(n(),s("button",{key:0,onClick:N,class:"move-to-previous-day"}," Oops, Past Midnight? Shift to Yesterday ")):A("",!0),t(C)?(n(),s("div",W,"âœ… Moved to previous day")):A("",!0),e[3]||(e[3]=a("div",{class:"footer"}," Additional details can go here. ",-1))]))}}});export{nt as default};
