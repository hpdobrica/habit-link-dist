import{_ as J}from"./BPMw4W1L.js";import{_ as X}from"./-vkRA7ue.js";import{m as j,r as H,g as G,o as r,c as n,x as y,a,N as m,R as V,W as K,d as D,X as E,_ as Q,U as Y,B as Z,J as f,F as C,u as U,b as N,t as S,w as ee,v as te}from"./C541R0zX.js";import{u as ae,g as oe}from"./CotfnO07.js";import{u as se}from"./Bi35agSF.js";import"./5hOz_2Hu.js";const re={key:1,class:"modal"},ne={class:"modal-controls"},ie={class:"form-group"},le={class:"form-group"},ue={class:"form-group"},de={class:"form-group"},ce={class:"target-selection"},pe=["disabled"],ge=j({__name:"createHabitModal",emits:["selectionMade"],setup(k,{expose:u,emit:h}){const e=H({icon:"",title:"",isTracked:!0,targetType:"completions",targetValue:0}),b=H(!1),_=h;function $(){if(e.value.icon==""||e.value.title==""||e.value.targetValue==0){alert("Please fill out all fields.");return}const g={icon:e.value.icon,title:e.value.title,isTracked:e.value.isTracked,targetDurationSec:e.value.targetType==="duration"?e.value.targetValue:0,targetCompletions:e.value.targetType==="completions"?e.value.targetValue:0};_("selectionMade",g),M(),x()}function M(){e.value={icon:"",title:"",isTracked:!0,targetType:"completions",targetValue:0}}G(()=>e.value.isTracked,g=>{g||(e.value.targetType="duration")});function T(){b.value=!0}function x(){b.value=!1}return u({openModal:T,closeModal:x}),(g,t)=>(r(),n("div",null,[b.value?(r(),n("div",{key:0,class:"modal-overlay",onClick:x})):y("",!0),b.value?(r(),n("div",re,[t[13]||(t[13]=a("h2",{class:"modal-title"},"Create a New Habit",-1)),a("div",ne,[a("div",ie,[t[7]||(t[7]=a("label",{for:"habit-icon"},"Icon (Emoji):",-1)),m(a("input",{id:"habit-icon",type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>e.value.icon=s),placeholder:"e.g., ðŸ’ª"},null,512),[[V,e.value.icon]])]),a("div",le,[t[8]||(t[8]=a("label",{for:"habit-title"},"Title:",-1)),m(a("input",{id:"habit-title",type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>e.value.title=s),placeholder:"Habit title"},null,512),[[V,e.value.title]])]),a("div",ue,[a("label",null,[m(a("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=s=>e.value.isTracked=s)},null,512),[[K,e.value.isTracked]]),t[9]||(t[9]=D(" Track this habit "))])]),a("div",de,[t[12]||(t[12]=a("label",null,"Target:",-1)),a("div",ce,[m(a("input",{type:"radio",value:"completions","onUpdate:modelValue":t[3]||(t[3]=s=>e.value.targetType=s),disabled:!e.value.isTracked},null,8,pe),[[E,e.value.targetType]]),t[10]||(t[10]=a("label",null," Number of Completions ",-1)),m(a("input",{type:"radio",value:"duration","onUpdate:modelValue":t[4]||(t[4]=s=>e.value.targetType=s)},null,512),[[E,e.value.targetType]]),t[11]||(t[11]=a("label",null," Duration (Seconds) ",-1))]),e.value.targetType==="completions"?m((r(),n("input",{key:0,type:"number","onUpdate:modelValue":t[5]||(t[5]=s=>e.value.targetValue=s),placeholder:"Enter number of completions"},null,512)),[[V,e.value.targetValue]]):y("",!0),e.value.targetType==="duration"?m((r(),n("input",{key:1,type:"number","onUpdate:modelValue":t[6]||(t[6]=s=>e.value.targetValue=s),placeholder:"Enter duration in seconds"},null,512)),[[V,e.value.targetValue]]):y("",!0)])]),a("button",{class:"submit-button",onClick:$},"Create Habit")])):y("",!0)]))}}),ve=Q(ge,[["__scopeId","data-v-33fe82d7"]]);async function me(){return!navigator.storage||!navigator.storage.persisted?!1:navigator.storage.persisted()}async function L(){return console.log("trying to persist storage"),!navigator.storage||!navigator.storage.persisted?(console.log("persistence features not available"),!1):navigator.storage.persist()}async function P(){if(!navigator.storage||!navigator.storage.persisted)return"never";let k=await me();if(k)return"persisted";if(!navigator.permissions||!navigator.permissions.query)return"prompt";try{const u=await navigator.permissions.query({name:"persistent-storage"});if(u.state==="granted"){if(k=await L(),k)return"persisted";throw new Error("Failed to persist")}if(u.state==="prompt")return"prompt"}catch(u){return console.error("Failed to check or request permission to use persistent storage",u),"prompt"}return"never"}const be={class:"habit-tracker"},fe={key:0,class:"persistence-warning"},ye={class:"habits"},ke={class:"date-heading weekday"},_e={key:1},Te={class:"habit-info"},xe={class:"habit-icon"},De=j({__name:"index",async setup(k){let u,h,e=H(([u,h]=Y(()=>P()),u=await u,h(),u));const b=async()=>{await L()||alert("The browser you are using is not supporting persistence, or you have disabled it. Please enable it to use this feature."),e.value=await P()},_=se(),$=_.habitsLoading,M=Z(()=>Object.fromEntries(Object.entries(_.habits.value).filter(([i,o])=>o.isTracked))),T=new Date,x=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g=ae();function t(i,o){const d=new Date(i);return d.setDate(d.getDate()-o),d}const s=H(null);function B(){s.value?s.value.openModal():console.error("CreateHabitModal is not available yet.")}const I=i=>{_.addHabit(i.icon,i.title,i.targetDurationSec,i.targetCompletions,i.isTracked)};function O(i,o){const d=M.value[i],w=d.targetDurationSec?"duration":"completions",l=oe(t(T,o)),c=w==="duration"?d.targetDurationSec:d.targetCompletions;let p=0;if(w==="duration"?p=Object.values(g.habitLogs.value).filter(v=>v.habitId===i&&v.date===l).reduce((v,z)=>v+z.durationSec,0):p=Object.values(g.habitLogs.value).filter(v=>v.habitId===i&&v.date===l).length,p===0)return{background:"#ccc"};const q=Math.min(p/c*100,100),F=Math.round(255*q/100),A=`rgb(${255-F}, 255, ${255-F})`,R=p>=c?"0 0 10px 2px rgba(0, 255, 0, 0.5)":"none",W=p>=c?"none":"1px solid #ddd";return{background:A,boxShadow:R,border:W}}return(i,o)=>{const d=J,w=X;return r(),n(C,null,[a("div",be,[a("div",{class:"header"},[o[2]||(o[2]=a("h1",null,"Habits",-1)),a("div",{class:"actions"},[a("button",{class:"create",onClick:B},"+"),o[1]||(o[1]=a("button",{class:"filter"},"â˜°",-1))])]),f(e)!="persisted"?(r(),n("div",fe,[o[3]||(o[3]=D(" âš ï¸ Using best-effort storage ")),f(e)!="never"?(r(),n("button",{key:0,class:"fix-button",onClick:o[0]||(o[0]=l=>b())},"Fix")):y("",!0)])):y("",!0),a("div",ye,[o[5]||(o[5]=a("div",{class:"habit-info"},null,-1)),(r(!0),n(C,null,U(Array.from({length:6},(l,c)=>c),l=>(r(),n("div",{class:"date-heading",key:l},[D(S(t(f(T),l).getDate()),1),o[4]||(o[4]=a("br",null,null,-1)),a("span",ke,S(x[t(f(T),l).getDay()]),1)]))),128))]),f($)?(r(),n("div",_e,"Loading...")):(r(!0),n(C,{key:2},U(f(M),l=>(r(),n("div",{class:"habits",key:l.id},[a("div",Te,[a("div",xe,S(l.icon),1),N(d,{to:{name:"habits-id",params:{id:l.id}},class:"habit-name"},{default:ee(()=>[D(S(l.title),1)]),_:2},1032,["to"])]),(r(!0),n(C,null,U(Array.from({length:6},(c,p)=>p),c=>(r(),n("div",{class:"day-entry",style:te(O(l.id,c)),key:c},null,4))),128))]))),128))]),N(ve,{ref_key:"createHabitModal",ref:s,onSelectionMade:I},null,512),N(w)],64)}}});export{De as default};
