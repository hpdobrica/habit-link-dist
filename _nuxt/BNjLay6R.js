import{_ as nt}from"./CTdwzV9_.js";import{m as Z,r as N,C as n,q as st,g as lt,o as Y,L as tt,w as P,y as it,M as ut,N as rt,O as ct,A as vt,B as O,c as dt,a as l,b as mt,D as u,t as C,E as R,d as ft}from"./BG282lcn.js";import{u as pt,a as ht}from"./DZIMZFo2.js";import{u as bt,H as X}from"./C739MnYr.js";import{u as gt}from"./BGBHUUAQ.js";import"./QBULzwXv.js";const V=1e3,j="abort",J="end",K="progress",Q="start",W="visibilitychange",wt=Z({__name:"countdown",props:{autoStart:{type:Boolean,default:!0},emitEvents:{type:Boolean,default:!0},interval:{type:Number,default:1e3,validator:i=>i>=0},now:{type:Function,default:()=>Date.now()},tag:{type:String,default:"div"},time:{type:Number,default:0,validator:i=>i>=0},date:{type:Date,default:null,validator:i=>i.getTime()>=0},transform:{type:Function,default:i=>i},withYears:{type:Boolean,default:!1},allowNegative:{type:Boolean,default:!1}},emits:[j,J,K,Q],setup(i,{expose:r,emit:c}){const D=60*V,d=60*D,f=24*d,k=365*f,e=i,E=c,a=N(!1),m=N(0),t=N(0),p=N(0),v=n(()=>{var b;return((b=e.date)==null?void 0:b.getTime())-e.now()||e.time}),g=n(()=>e.withYears?Math.floor(t.value/k):0),y=n(()=>e.withYears?Math.floor(t.value%k/f):Math.floor(t.value/f)),B=n(()=>Math.floor(t.value%f/d)),L=n(()=>Math.floor(t.value%d/D)),A=n(()=>Math.floor(t.value%D/V)),w=n(()=>Math.floor(t.value%V)),o=n(()=>e.withYears?y.value+g.value*365:y.value),_=n(()=>Math.floor(t.value/d)),I=n(()=>Math.floor(t.value/D)),S=n(()=>Math.floor(t.value/V));st(()=>{t.value=v.value,m.value=e.now()+v.value,e.autoStart&&s(),document.addEventListener(W,U)}),lt(()=>{document.removeEventListener(W,U),h()});const s=()=>{a.value||(a.value=!0,e.autoStart||(t.value=v.value,m.value=e.now()+v.value),e.emitEvents&&E(Q),document.visibilityState==="visible"&&M())},M=()=>{if(!a.value)return;const b=Math.min(t.value,e.interval);if(e.allowNegative||b>0){let H,x;const G=T=>{H||(H=T),x||(x=T);const z=T-H;z>=b||z+(T-x)/2>=b?$():p.value=requestAnimationFrame(G),x=T};p.value=requestAnimationFrame(G)}else e.allowNegative||(console.log("calling end from continue"),F())},h=()=>{cancelAnimationFrame(p.value)},$=()=>{a.value&&(q(),e.emitEvents&&(e.allowNegative||t.value>0)&&E(K,{years:g.value,days:y.value,hours:B.value,minutes:L.value,seconds:A.value,milliseconds:w.value,totalDays:o.value,totalHours:_.value,totalMinutes:I.value,totalSeconds:S.value,totalMilliseconds:t.value}),M())},et=()=>{a.value&&(h(),a.value=!1,e.emitEvents&&E(j))},F=()=>{console.log("countdown ended"),a.value&&(h(),t.value=0,a.value=!1,e.emitEvents&&E(J))},q=()=>{a.value&&(e.allowNegative?t.value=m.value-e.now():t.value=Math.max(0,m.value-e.now()))},at=()=>{h(),t.value=v.value,m.value=e.now()+v.value,a.value=!1,s()},U=()=>{switch(document.visibilityState){case"visible":q(),M();break;case"hidden":h();break}},ot=n(()=>e.transform({years:g.value,days:y.value,hours:B.value,minutes:L.value,seconds:A.value,milliseconds:w.value,totalDays:o.value,totalHours:_.value,totalMinutes:I.value,totalSeconds:S.value,totalMilliseconds:t.value}));return r({start:s,pause:h,abort:et,end:F,restart:at}),(b,H)=>(Y(),tt(ct(i.tag),null,{default:P(()=>[it(b.$slots,"default",ut(rt(ot.value)))]),_:3}))}}),_t={class:"page"},St={class:"top-bar"},Mt={class:"routine-title"},Et={class:"timer-section"},yt={class:"timer-icon"},It={class:"countdown-timer"},Nt={class:"total-duration"},Bt=Z({__name:"run",async setup(i){let r,c;const d=vt().params.id;if(typeof d!="string")throw[r,c]=O(()=>R("/")),await r,c(),new Error("wrong routine id");pt();const f=bt(),k=ht(),e=gt(),E={id:"routine-null",title:"",habitInstances:[]},a=n(()=>k.value[d]||E);if(!a)throw[r,c]=O(()=>R("/")),await r,c(),new Error("wrong routine id");if(!a.value)throw[r,c]=O(()=>R("/")),await r,c(),new Error("wrong routine id");if(a.value.id==="routine-null")throw[r,c]=O(()=>R("/")),await r,c(),new Error("wrong routine id");const m=()=>{p.value=new Date,p.value.setSeconds(p.value.getSeconds()+a.value.habitInstances[t.value].durationSec),v=new Date},t=N(0);let p=N(new Date),v=new Date;m();const g=f.createRoutineLog(d),y=()=>{const o=Math.abs((new Date().getTime()-v.getTime())/1e3);f.createHabitLog(a.value.habitInstances[t.value].habitId,X.Completed,o,g),t.value++,L(),m()},B=()=>{const o=Math.abs((new Date().getTime()-v.getTime())/1e3);f.createHabitLog(a.value.habitInstances[t.value].habitId,X.Skipped,o,g),t.value++,L(),m()},L=async()=>{console.log(a.value.habitInstances.length,t.value),a.value.habitInstances.length<=t.value&&await R(`/routines/${d}/complete/${g}`)},A=w=>{const o={},{totalSeconds:_}=w,I=_<0,S=Math.abs(_),s=Math.floor(S/60),M=S%60,h=I?`-${s<10?`0${s}`:s}`:s<10?`0${s}`:String(s),$=M<10?`0${M}`:String(M);return o.minutes=h,o.seconds=$,o};return(w,o)=>{const _=nt,I=wt;return Y(),dt("div",_t,[l("div",St,[o[1]||(o[1]=l("div",{class:"placeholder"},null,-1)),mt(_,{to:{name:"routines-id",params:{id:u(a).id}},class:"close-button"},{default:P(()=>o[0]||(o[0]=[ft("X")])),_:1},8,["to"])]),l("h1",Mt,C(u(e).habits.value[u(a).habitInstances[u(t)].habitId].title),1),l("div",Et,[l("div",yt,C(u(e).habits.value[u(a).habitInstances[u(t)].habitId].icon),1),(Y(),tt(I,{date:u(p),transform:A,"allow-negative":!0,key:u(t)},{default:P(({minutes:S,seconds:s})=>[l("div",It,C(S)+":"+C(s),1)]),_:1},8,["date"])),l("div",Nt,C(u(a).habitInstances[u(t)].durationSec)+"s",1)]),l("div",{class:"action-buttons"},[o[2]||(o[2]=l("button",{class:"action-button pause-button"},"⏸️",-1)),l("button",{class:"action-button complete-button",onClick:y},"✔️"),l("button",{class:"action-button skip-button",onClick:B},"⏭️")]),o[3]||(o[3]=l("div",{class:"footer"}," Additional details can go here. ",-1))])}}});export{Bt as default};
