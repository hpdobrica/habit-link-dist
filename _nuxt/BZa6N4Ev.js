import{_ as P}from"./LT-mpUfG.js";import{u as V,g as h}from"./CDWzdD5_.js";import{m as E,S as T,U as H,B as I,e as F,r as R,J as t,c as s,a,b as J,w as O,t as l,F as U,u as X,x as A,V as p,o as n,d as Y}from"./R0FuxEGI.js";import{u as j}from"./CqcENb5e.js";import{u as q}from"./DrFPDOnU.js";import"./5hOz_2Hu.js";const z={key:0},G={key:1,class:"page"},K={class:"top-bar"},Q={class:"routine-title"},W={key:1},nt=E({__name:"complete",async setup(Z){let _,y;const M=T(),c=M.params.id,o=M.params.routineLogId;if(typeof c!="string")throw[_,y]=H(()=>p("/")),await _,y(),new Error("wrong routine id");const w=j(),b=q(),g=V(),L=w.routines,x=w.routinesLoading,D=I(()=>L.value[c]??null),i=g.habitLogs,r=g.routineLogs,v=g.statsLoading;F(()=>{!x.value&&!L.value[c]&&p("/"),!v.value&&!r.value[o]&&p("/"),!v.value&&r.value[o].routineId!==c&&p("/")});const k=new Date,u=new Date(k);u.setDate(u.getDate()-1);const S=R(!1),C=()=>{const d=r.value[o].date!==h(u),e=r.value[o].habitLogIds.some(f=>i.value[f].date!==h(u));return d||e},B=I(()=>k.getHours()<4?C():!1);async function N(){try{C()&&await g.updateExecutionDates(o,h(u)),S.value=!0}catch(d){console.error("failed moving logs to previous day",d)}}return(d,e)=>{const f=P;return t(x)||t(v)?(n(),s("div",z,"Loading...")):(n(),s("div",G,[a("div",K,[e[1]||(e[1]=a("div",{class:"placeholder"},null,-1)),J(f,{to:{name:"routines-id",params:{id:t(D).id}},class:"close-button"},{default:O(()=>e[0]||(e[0]=[Y("X ")])),_:1},8,["to"])]),a("h1",Q,l(t(D).title)+" complete!",1),a("ul",null,[(n(!0),s(U,null,X(t(r)[t(o)].habitLogIds,m=>(n(),s("li",null,l(t(b).habits.value[t(i)[m].habitId].icon)+" "+l(t(b).habits.value[t(i)[m].habitId].title)+" "+l(Math.round(t(i)[m].durationSec))+"s "+l(t(i)[m].status),1))),256))]),e[2]||(e[2]=a("div",{style:{height:"20px"}},null,-1)),t(B)?(n(),s("button",{key:0,onClick:N,class:"move-to-previous-day"}," Oops, Past Midnight? Shift to Yesterday ")):A("",!0),t(S)?(n(),s("div",W,"âœ… Moved to previous day")):A("",!0),e[3]||(e[3]=a("div",{class:"footer"}," Additional details can go here. ",-1))]))}}});export{nt as default};
