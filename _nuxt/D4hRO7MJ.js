import{_ as ee}from"./DET2Issf.js";import{_ as te}from"./HjwAPsnG.js";import{m as B,r as p,g as ae,o as n,c as i,x as M,a as e,N as b,R as F,W as P,d as H,X as I,_ as q,U as oe,B as re,J as h,F as D,u as E,b as $,t as N,w as se,v as ne}from"./DkXs4dLR.js";import{u as ie,a as le,g as ue}from"./CZZ_NmZS.js";import"./D9eZtM2H.js";import"./Cb9qwsxW.js";const de={key:1,class:"modal"},ce={class:"modal-controls"},pe={class:"form-group"},ve={class:"form-group"},ge={class:"form-group"},me={class:"form-group"},fe={class:"target-selection"},be=["disabled"],ye=B({__name:"createHabitModal",emits:["selectionMade"],setup(x,{expose:u,emit:C}){const t=p({icon:"",title:"",isTracked:!0,targetType:"completions",targetValue:0}),c=p(!1),v=C;function V(){if(t.value.icon==""||t.value.title==""||t.value.targetValue==0){alert("Please fill out all fields.");return}const d={icon:t.value.icon,title:t.value.title,isTracked:t.value.isTracked,targetDurationSec:t.value.targetType==="duration"?t.value.targetValue:0,targetCompletions:t.value.targetType==="completions"?t.value.targetValue:0};v("selectionMade",d),y(),T()}function y(){t.value={icon:"",title:"",isTracked:!0,targetType:"completions",targetValue:0}}ae(()=>t.value.isTracked,d=>{d||(t.value.targetType="duration")});function k(){c.value=!0}function T(){c.value=!1}return u({openModal:k,closeModal:T}),(d,a)=>(n(),i("div",null,[c.value?(n(),i("div",{key:0,class:"modal-overlay",onClick:T})):M("",!0),c.value?(n(),i("div",de,[a[13]||(a[13]=e("h2",{class:"modal-title"},"Create a New Habit",-1)),e("div",ce,[e("div",pe,[a[7]||(a[7]=e("label",{for:"habit-icon"},"Icon (Emoji):",-1)),b(e("input",{id:"habit-icon",type:"text","onUpdate:modelValue":a[0]||(a[0]=o=>t.value.icon=o),placeholder:"e.g., ðŸ’ª"},null,512),[[F,t.value.icon]])]),e("div",ve,[a[8]||(a[8]=e("label",{for:"habit-title"},"Title:",-1)),b(e("input",{id:"habit-title",type:"text","onUpdate:modelValue":a[1]||(a[1]=o=>t.value.title=o),placeholder:"Habit title"},null,512),[[F,t.value.title]])]),e("div",ge,[e("label",null,[b(e("input",{type:"checkbox","onUpdate:modelValue":a[2]||(a[2]=o=>t.value.isTracked=o)},null,512),[[P,t.value.isTracked]]),a[9]||(a[9]=H(" Track this habit "))])]),e("div",me,[a[12]||(a[12]=e("label",null,"Target:",-1)),e("div",fe,[b(e("input",{type:"radio",value:"completions","onUpdate:modelValue":a[3]||(a[3]=o=>t.value.targetType=o),disabled:!t.value.isTracked},null,8,be),[[I,t.value.targetType]]),a[10]||(a[10]=e("label",null," Number of Completions ",-1)),b(e("input",{type:"radio",value:"duration","onUpdate:modelValue":a[4]||(a[4]=o=>t.value.targetType=o)},null,512),[[I,t.value.targetType]]),a[11]||(a[11]=e("label",null," Duration (Seconds) ",-1))]),t.value.targetType==="completions"?b((n(),i("input",{key:0,type:"number","onUpdate:modelValue":a[5]||(a[5]=o=>t.value.targetValue=o),placeholder:"Enter number of completions"},null,512)),[[F,t.value.targetValue]]):M("",!0),t.value.targetType==="duration"?b((n(),i("input",{key:1,type:"number","onUpdate:modelValue":a[6]||(a[6]=o=>t.value.targetValue=o),placeholder:"Enter duration in seconds"},null,512)),[[F,t.value.targetValue]]):M("",!0)])]),e("button",{class:"submit-button",onClick:V},"Create Habit")])):M("",!0)]))}}),ke=q(ye,[["__scopeId","data-v-33fe82d7"]]),Te={key:1,class:"modal"},_e={class:"modal-controls"},he=B({__name:"filterHabitModal",props:{archived:Boolean,nonTracked:Boolean},emits:["filtersApplied"],setup(x,{expose:u,emit:C}){const t=x,c=p(!1),v=p(t.archived),V=p(t.nonTracked),y=C;function k(){y("filtersApplied",{archived:v.value,nonTracked:V.value}),d()}function T(){c.value=!0}function d(){c.value=!1}return u({openModal:T,closeModal:d}),(a,o)=>(n(),i("div",null,[c.value?(n(),i("div",{key:0,class:"modal-overlay",onClick:d})):M("",!0),c.value?(n(),i("div",Te,[o[4]||(o[4]=e("h2",{class:"modal-title"},"Filter Habits",-1)),e("div",_e,[e("label",null,[b(e("input",{type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=w=>v.value=w)},null,512),[[P,v.value]]),o[2]||(o[2]=H(" Archived "))]),e("label",null,[b(e("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=w=>V.value=w)},null,512),[[P,V.value]]),o[3]||(o[3]=H(" Non-tracked "))])]),e("button",{class:"submit-button",onClick:k},"Apply Filters")])):M("",!0)]))}}),Me=q(he,[["__scopeId","data-v-8a677938"]]);async function xe(){return!navigator.storage||!navigator.storage.persisted?!1:navigator.storage.persisted()}async function L(){return console.log("trying to persist storage"),!navigator.storage||!navigator.storage.persisted?(console.log("persistence features not available"),!1):navigator.storage.persist()}async function O(){if(!navigator.storage||!navigator.storage.persisted)return"never";let x=await xe();if(x)return"persisted";if(!navigator.permissions||!navigator.permissions.query)return"prompt";try{const u=await navigator.permissions.query({name:"persistent-storage"});if(u.state==="granted"){if(x=await L(),x)return"persisted";throw new Error("Failed to persist")}if(u.state==="prompt")return"prompt"}catch(u){return console.error("Failed to check or request permission to use persistent storage",u),"prompt"}return"never"}const Ve={class:"habit-tracker"},we={key:0,class:"persistence-warning"},Ce={class:"habits"},He={class:"date-heading weekday"},Se={key:1},Fe={class:"habit-info"},De={class:"habit-icon"},Be=B({__name:"index",async setup(x){let u,C,t=p(([u,C]=oe(()=>O()),u=await u,C(),u));const c=async()=>{await L()||alert("The browser you are using is not supporting persistence, or you have disabled it. Please enable it to use this feature."),t.value=await O()},v=ie(),V=v.habitsLoading,y=p(!1),k=p(!1),T=re(()=>Object.fromEntries(Object.entries(v.habits.value).filter(([s,r])=>!y.value&&!r.isTracked?(console.log("Filtered out (NonTracked)",r,y.value,r.isTracked),!1):!k.value&&r.archived==1?(console.log("Filtered out (Archived)",r,k.value,r.archived),!1):!0))),d=new Date,a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],o=le();function w(s,r){const g=new Date(s);return g.setDate(g.getDate()-r),g}const U=p(null),A=p(null);function R(){U.value?U.value.openModal():console.error("CreateHabitModal is not available yet.")}function W(){A.value?A.value.openModal():console.error("FilterHabitModal is not available yet.")}const z=s=>{v.addHabit(s.icon,s.title,s.targetDurationSec,s.targetCompletions,s.isTracked)},J=s=>{console.log(s),y.value=s.nonTracked,k.value=s.archived};function X(s,r){const g=T.value[s],S=g.targetDurationSec?"duration":"completions",l=ue(w(d,r)),m=S==="duration"?g.targetDurationSec:g.targetCompletions;let _=0;if(S==="duration"?_=Object.values(o.habitLogs.value).filter(f=>f.habitId===s&&f.date===l&&f.status==="Completed").reduce((f,Z)=>f+Z.durationSec,0):_=Object.values(o.habitLogs.value).filter(f=>f.habitId===s&&f.date===l&&f.status==="Completed").length,_===0)return{background:"#ccc"};const G=Math.min(_/m*100,100),j=Math.round(255*G/100),K=`rgb(${255-j}, 255, ${255-j})`,Q=_>=m?"0 0 10px 2px rgba(0, 255, 0, 0.5)":"none",Y=_>=m?"none":"1px solid #ddd";return{background:K,boxShadow:Q,border:Y}}return(s,r)=>{const g=ee,S=te;return n(),i(D,null,[e("div",Ve,[e("div",{class:"header"},[r[1]||(r[1]=e("h1",null,"Habits",-1)),e("div",{class:"actions"},[e("button",{class:"create",onClick:R},"+"),e("button",{class:"filter",onClick:W},"â˜°")])]),h(t)!="persisted"?(n(),i("div",we,[r[2]||(r[2]=H(" âš ï¸ Using best-effort storage ")),h(t)!="never"?(n(),i("button",{key:0,class:"fix-button",onClick:r[0]||(r[0]=l=>c())},"Fix")):M("",!0)])):M("",!0),e("div",Ce,[r[4]||(r[4]=e("div",{class:"habit-info"},null,-1)),(n(!0),i(D,null,E(Array.from({length:6},(l,m)=>m),l=>(n(),i("div",{class:"date-heading",key:l},[H(N(w(h(d),l).getDate()),1),r[3]||(r[3]=e("br",null,null,-1)),e("span",He,N(a[w(h(d),l).getDay()]),1)]))),128))]),h(V)?(n(),i("div",Se,"Loading...")):(n(!0),i(D,{key:2},E(h(T),l=>(n(),i("div",{class:"habits",key:l.id},[e("div",Fe,[e("div",De,N(l.icon),1),$(g,{to:{name:"habits-id",params:{id:l.id}},class:"habit-name"},{default:se(()=>[H(N(l.title),1)]),_:2},1032,["to"])]),(n(!0),i(D,null,E(Array.from({length:6},(m,_)=>_),m=>(n(),i("div",{class:"day-entry",style:ne(X(l.id,m)),key:m},null,4))),128))]))),128))]),$(ke,{ref_key:"createHabitModal",ref:U,onSelectionMade:z},null,512),$(Me,{ref_key:"filterHabitModal",ref:A,archived:h(k),"non-tracked":h(y),onFiltersApplied:J},null,8,["archived","non-tracked"]),$(S)],64)}}});export{Be as default};
