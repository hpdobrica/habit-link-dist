import{a as R}from"./QBULzwXv.js";import{u as m,g as v}from"./BGBHUUAQ.js";const d=()=>R("routines",()=>({})),T=()=>{const a=d(),{linkHabitToRoutine:r,unlinkHabitFromRoutine:l,habits:b}=m(),f=n=>{const t=v("routine");a.value[t]={id:t,title:n,habitInstances:[]}},h=(n,t,e)=>{const s=a.value[n];if(s){const o=s.habitInstances.filter(i=>i.habitId===t).length,I=`${t}-${o}`;let c;if(e==null){const i=b.value[t].targetDurationSec;if(c=i,i==0)throw new Error("NO_HABIT_DURATION")}else c=e;s.habitInstances.push({habitId:t,durationSec:c,habitInstanceId:I}),r(t,n)}},u=(n,t)=>{const e=a.value[n];if(e){const s=e.habitInstances.find(o=>o.habitInstanceId===t);s&&(e.habitInstances=e.habitInstances.filter(o=>o.habitInstanceId!==t),l(s.habitId,n))}};return{routines:a,addRoutine:f,addHabitInstanceToRoutine:h,removeHabitInstance:u,removeRoutine:n=>{const t=a.value[n];t==null||t.habitInstances.forEach(e=>{u(n,e.habitInstanceId)}),delete a.value[n]}}};export{d as a,T as u};
