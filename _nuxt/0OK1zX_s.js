import{d as u}from"./5hOz_2Hu.js";import{bU as k,p as R,aM as w,bT as g,bs as v}from"./Bdlf0Gjw.js";const H="$s";function h(...t){const s=typeof t[t.length-1]=="string"?t.pop():void 0;typeof t[0]!="string"&&t.unshift(s);const[o,n]=t;if(!o||typeof o!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+o);if(n!==void 0&&typeof n!="function")throw new Error("[nuxt] [useState] init must be a function: "+n);const r=H+o,c=k(),l=R(c.payload.state,r);if(l.value===void 0&&n){const e=n();if(w(e))return c.payload.state[r]=e,e;l.value=e}return l}function x(t){const s=`${Date.now()}-${Math.random().toString(36).substring(2,10)}`;return`${t}-${s}`}const F=()=>{const t=h("habits",()=>({})),s=h("habits-loading",()=>!0),o=async()=>{s.value=!0;try{const n=await u.habits.toArray();Object.assign(t.value,Object.fromEntries(n.map(r=>[r.id,r])))}catch(n){console.error("Failed to load habits:",n)}finally{s.value=!1}};return console.debug("habits init scheduled"),g(async()=>{console.debug("habits init started");try{await o()}catch(n){console.error("habits init error",n)}console.debug("habits init finished")}),{habits:t,loadHabits:o,habitsLoading:s}},T=()=>{const{habits:t,loadHabits:s,habitsLoading:o}=F();return{habits:t,habitsLoading:o,addHabit:async(e,a,i,d,y=!0,p=[])=>{const b=x("habit"),f={id:b,icon:e,title:a,isTracked:y,targetDurationSec:i,targetCompletions:d,linkedRoutines:p};try{await u.habits.add(f),t.value[b]=f}catch(m){console.error("Failed to add habit:",m)}},removeHabit:async e=>{try{await u.habits.delete(e),delete t.value[e]}catch(a){console.error("Failed to remove habit:",a)}},linkHabitToRoutine:async(e,a)=>{await u.habits.where("id").equals(e).modify(i=>{i.linkedRoutines.includes(a)||i.linkedRoutines.push(a)}),t.value[e].linkedRoutines.push(a)},unlinkHabitFromRoutine:async(e,a)=>{try{await u.habits.where("id").equals(e).modify(i=>{i.linkedRoutines&&(i.linkedRoutines=v(i.linkedRoutines.filter(d=>d!==a)))}),t.value[e].linkedRoutines=t.value[e].linkedRoutines.filter(i=>i!==a)}catch(i){throw console.error("error unlinking habits from routine",i),i}}}};export{h as a,x as g,T as u};
