import{_ as G}from"./CC0QIQHD.js";import{_ as J}from"./BGcKBYyQ.js";import{m as j,r as H,g as K,o as r,c as n,x as y,a,A as m,B as h,I as Q,d as D,J as F,_ as X,E as Y,G as Z,C as f,F as C,u as U,b as E,t as S,w as ee,v as te}from"./C9_ey-L1.js";import{u as ae}from"./C29uwpdd.js";import{u as oe}from"./CFNN-g90.js";import"./CAFlqnyI.js";const se={key:1,class:"modal"},re={class:"modal-controls"},ne={class:"form-group"},ie={class:"form-group"},le={class:"form-group"},ue={class:"form-group"},de={class:"target-selection"},pe=["disabled"],ce=j({__name:"createHabitModal",emits:["selectionMade"],setup(k,{expose:u,emit:M}){const e=H({icon:"",title:"",isTracked:!0,targetType:"completions",targetValue:0}),b=H(!1),_=M;function $(){if(e.value.icon==""||e.value.title==""||e.value.targetValue==0){alert("Please fill out all fields.");return}const g={icon:e.value.icon,title:e.value.title,isTracked:e.value.isTracked,targetDurationSec:e.value.targetType==="duration"?e.value.targetValue:0,targetCompletions:e.value.targetType==="completions"?e.value.targetValue:0};_("selectionMade",g),w(),x()}function w(){e.value={icon:"",title:"",isTracked:!0,targetType:"completions",targetValue:0}}K(()=>e.value.isTracked,g=>{g||(e.value.targetType="duration")});function T(){b.value=!0}function x(){b.value=!1}return u({openModal:T,closeModal:x}),(g,t)=>(r(),n("div",null,[b.value?(r(),n("div",{key:0,class:"modal-overlay",onClick:x})):y("",!0),b.value?(r(),n("div",se,[t[13]||(t[13]=a("h2",{class:"modal-title"},"Create a New Habit",-1)),a("div",re,[a("div",ne,[t[7]||(t[7]=a("label",{for:"habit-icon"},"Icon (Emoji):",-1)),m(a("input",{id:"habit-icon",type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>e.value.icon=s),placeholder:"e.g., 💪"},null,512),[[h,e.value.icon]])]),a("div",ie,[t[8]||(t[8]=a("label",{for:"habit-title"},"Title:",-1)),m(a("input",{id:"habit-title",type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>e.value.title=s),placeholder:"Habit title"},null,512),[[h,e.value.title]])]),a("div",le,[a("label",null,[m(a("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=s=>e.value.isTracked=s)},null,512),[[Q,e.value.isTracked]]),t[9]||(t[9]=D(" Track this habit "))])]),a("div",ue,[t[12]||(t[12]=a("label",null,"Target:",-1)),a("div",de,[m(a("input",{type:"radio",value:"completions","onUpdate:modelValue":t[3]||(t[3]=s=>e.value.targetType=s),disabled:!e.value.isTracked},null,8,pe),[[F,e.value.targetType]]),t[10]||(t[10]=a("label",null," Number of Completions ",-1)),m(a("input",{type:"radio",value:"duration","onUpdate:modelValue":t[4]||(t[4]=s=>e.value.targetType=s)},null,512),[[F,e.value.targetType]]),t[11]||(t[11]=a("label",null," Duration (Seconds) ",-1))]),e.value.targetType==="completions"?m((r(),n("input",{key:0,type:"number","onUpdate:modelValue":t[5]||(t[5]=s=>e.value.targetValue=s),placeholder:"Enter number of completions"},null,512)),[[h,e.value.targetValue]]):y("",!0),e.value.targetType==="duration"?m((r(),n("input",{key:1,type:"number","onUpdate:modelValue":t[6]||(t[6]=s=>e.value.targetValue=s),placeholder:"Enter duration in seconds"},null,512)),[[h,e.value.targetValue]]):y("",!0)])]),a("button",{class:"submit-button",onClick:$},"Create Habit")])):y("",!0)]))}}),ge=X(ce,[["__scopeId","data-v-33fe82d7"]]);async function ve(){return!navigator.storage||!navigator.storage.persisted?!1:navigator.storage.persisted()}async function I(){return console.log("trying to persist storage"),!navigator.storage||!navigator.storage.persisted?(console.log("persistence features not available"),!1):navigator.storage.persist()}async function P(){if(!navigator.storage||!navigator.storage.persisted)return"never";let k=await ve();if(k)return"persisted";if(!navigator.permissions||!navigator.permissions.query)return"prompt";const u=await navigator.permissions.query({name:"persistent-storage"});if(u.state==="granted"){if(k=await I(),k)return"persisted";throw new Error("Failed to persist")}return u.state==="prompt"?"prompt":"never"}const me={class:"habit-tracker"},be={key:0,class:"persistence-warning"},fe={class:"habits"},ye={class:"date-heading weekday"},ke={key:1},_e={class:"habit-info"},Te={class:"habit-icon"},Se=j({__name:"index",async setup(k){let u,M,e=H(([u,M]=Y(()=>P()),u=await u,M(),u));const b=async()=>{await I()||alert("The browser you are using is not supporting persistence, or you have disabled it. Please enable it to use this feature."),e.value=await P()},_=ae(),$=_.habitsLoading,w=Z(()=>Object.fromEntries(Object.entries(_.habits.value).filter(([i,o])=>o.isTracked))),T=new Date,x=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g=oe();function t(i,o){const d=new Date(i);return d.setDate(d.getDate()-o),d}const s=H(null);function L(){s.value?s.value.openModal():console.error("CreateHabitModal is not available yet.")}const O=i=>{_.addHabit(i.icon,i.title,i.targetDurationSec,i.targetCompletions,i.isTracked)};function A(i,o){const d=w.value[i],V=d.targetDurationSec?"duration":"completions",l=t(T,o).toISOString().split("T")[0],p=V==="duration"?d.targetDurationSec:d.targetCompletions;let c=0;if(V==="duration"?c=Object.values(g.habitLogs.value).filter(v=>v.habitId===i&&v.date===l).reduce((v,z)=>v+z.durationSec,0):c=Object.values(g.habitLogs.value).filter(v=>v.habitId===i&&v.date===l).length,c===0)return{background:"#ccc"};const B=Math.min(c/p*100,100),N=Math.round(255*B/100),q=`rgb(${255-N}, 255, ${255-N})`,R=c>=p?"0 0 10px 2px rgba(0, 255, 0, 0.5)":"none",W=c>=p?"none":"1px solid #ddd";return{background:q,boxShadow:R,border:W}}return(i,o)=>{const d=G,V=J;return r(),n(C,null,[a("div",me,[a("div",{class:"header"},[o[2]||(o[2]=a("h1",null,"Habits",-1)),a("div",{class:"actions"},[a("button",{class:"create",onClick:L},"+"),o[1]||(o[1]=a("button",{class:"filter"},"☰",-1))])]),f(e)!="persisted"?(r(),n("div",be,[o[3]||(o[3]=D(" ⚠️ Using best-effort storage ")),f(e)!="never"?(r(),n("button",{key:0,class:"fix-button",onClick:o[0]||(o[0]=l=>b())},"Fix")):y("",!0)])):y("",!0),a("div",fe,[o[5]||(o[5]=a("div",{class:"habit-info"},null,-1)),(r(!0),n(C,null,U(Array.from({length:6},(l,p)=>p),l=>(r(),n("div",{class:"date-heading",key:l},[D(S(t(f(T),l).getDate()),1),o[4]||(o[4]=a("br",null,null,-1)),a("span",ye,S(x[t(f(T),l).getDay()]),1)]))),128))]),f($)?(r(),n("div",ke,"Loading...")):(r(!0),n(C,{key:2},U(f(w),l=>(r(),n("div",{class:"habits",key:l.id},[a("div",_e,[a("div",Te,S(l.icon),1),E(d,{to:{name:"habits-id",params:{id:l.id}},class:"habit-name"},{default:ee(()=>[D(S(l.title),1)]),_:2},1032,["to"])]),(r(!0),n(C,null,U(Array.from({length:6},(p,c)=>c),p=>(r(),n("div",{class:"day-entry",style:te(A(l.id,p)),key:p},null,4))),128))]))),128))]),E(ge,{ref_key:"createHabitModal",ref:s,onSelectionMade:O},null,512),E(V)],64)}}});export{Se as default};
