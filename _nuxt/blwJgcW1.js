import{_ as Be}from"./MbFivM8r.js";import{a as Pe,H as de}from"./5hOz_2Hu.js";import{a as Se}from"./Cag_aQBJ.js";import{m as Ee,r as F,B as G,q as Fe,g as Ue,H as Ye,o as W,D as we,w as ue,y as xe,K as $e,aI as Ve,L as je,s as ve,S as Ke,U as ne,e as me,J as d,c as ae,a as C,b as We,t as j,V as z,d as qe}from"./Bh9cbdkm.js";import{u as ze}from"./tj1QX26m.js";import{u as Ge}from"./CrLP0oLD.js";import{u as Je}from"./BDM1QsvT.js";var he={},pe;function Xe(){return pe||(pe=1,function(U){var E=1,l=2,w=4,p=8,y=16,T=32,c=64,s=128,f=256,g=512,b=1024,Y=s|c|y|p|w|l,o=1e3,m=60,S=60,u=24,k=u*S*m*o,I=7,L=12,_=10,D=10,B=10,x=Math.ceil,t=Math.floor;function v(e,a){var n=e.getTime();return e.setMonth(e.getMonth()+a),Math.round((e.getTime()-n)/k)}function H(e){var a=e.getTime(),n=new Date(a);return n.setMonth(e.getMonth()+1),Math.round((n.getTime()-a)/k)}function A(e){var a=e.getTime(),n=new Date(a);return n.setFullYear(e.getFullYear()+1),Math.round((n.getTime()-a)/k)}function R(e,a){if(a=a instanceof Date||a!==null&&isFinite(a)?new Date(+a):new Date,!e)return a;var n=+e.value||0;return n?(a.setTime(a.getTime()+n),a):(n=+e.milliseconds||0,n&&a.setMilliseconds(a.getMilliseconds()+n),n=+e.seconds||0,n&&a.setSeconds(a.getSeconds()+n),n=+e.minutes||0,n&&a.setMinutes(a.getMinutes()+n),n=+e.hours||0,n&&a.setHours(a.getHours()+n),n=+e.weeks||0,n&&(n*=I),n+=+e.days||0,n&&a.setDate(a.getDate()+n),n=+e.months||0,n&&a.setMonth(a.getMonth()+n),n=+e.millennia||0,n&&(n*=B),n+=+e.centuries||0,n&&(n*=D),n+=+e.decades||0,n&&(n*=_),n+=+e.years||0,n&&a.setFullYear(a.getFullYear()+n),a)}var $=0,ie=1,ye=2,ge=3,Le=4,Ie=5,Te=6,_e=7,De=8,Ne=9,te=10,J,X,Q,Z,ee,N,re;function Me(e,a){return re(e)+(e===1?J[a]:X[a])}var oe;function V(){}V.prototype.toString=function(e){var a=oe(this),n=a.length;if(!n)return e?""+e:ee;if(n===1)return a[0];var r=Q+a.pop();return a.join(Z)+r},V.prototype.toHTML=function(e,a){e=e||"span";var n=oe(this),r=n.length;if(!r)return a=a||ee,a&&"<"+e+">"+a+"</"+e+">";for(var i=0;i<r;i++)n[i]="<"+e+">"+n[i]+"</"+e+">";if(r===1)return n[0];var M=Q+n.pop();return n.join(Z)+M},V.prototype.addTo=function(e){return R(this,e)},oe=function(e){var a=[],n=e.millennia;return n&&a.push(N(n,te)),n=e.centuries,n&&a.push(N(n,Ne)),n=e.decades,n&&a.push(N(n,De)),n=e.years,n&&a.push(N(n,_e)),n=e.months,n&&a.push(N(n,Te)),n=e.weeks,n&&a.push(N(n,Ie)),n=e.days,n&&a.push(N(n,Le)),n=e.hours,n&&a.push(N(n,ge)),n=e.minutes,n&&a.push(N(n,ye)),n=e.seconds,n&&a.push(N(n,ie)),n=e.milliseconds,n&&a.push(N(n,$)),a};function Ce(e,a){switch(a){case"seconds":if(e.seconds!==m||isNaN(e.minutes))return;e.minutes++,e.seconds=0;case"minutes":if(e.minutes!==S||isNaN(e.hours))return;e.hours++,e.minutes=0;case"hours":if(e.hours!==u||isNaN(e.days))return;e.days++,e.hours=0;case"days":if(e.days!==I||isNaN(e.weeks))return;e.weeks++,e.days=0;case"weeks":if(e.weeks!==H(e.refMonth)/I||isNaN(e.months))return;e.months++,e.weeks=0;case"months":if(e.months!==L||isNaN(e.years))return;e.years++,e.months=0;case"years":if(e.years!==_||isNaN(e.decades))return;e.decades++,e.years=0;case"decades":if(e.decades!==D||isNaN(e.centuries))return;e.centuries++,e.decades=0;case"centuries":if(e.centuries!==B||isNaN(e.millennia))return;e.millennia++,e.centuries=0}}function O(e,a,n,r,i,M){return e[n]>=0&&(a+=e[n],delete e[n]),a/=i,a+1<=1?0:e[r]>=0?(e[r]=+(e[r]+a).toFixed(M),Ce(e,r),0):a}function be(e,a){var n=O(e,0,"milliseconds","seconds",o,a);if(n&&(n=O(e,n,"seconds","minutes",m,a),!!n&&(n=O(e,n,"minutes","hours",S,a),!!n&&(n=O(e,n,"hours","days",u,a),!!n&&(n=O(e,n,"days","weeks",I,a),!!n&&(n=O(e,n,"weeks","months",H(e.refMonth)/I,a),!!n&&(n=O(e,n,"months","years",A(e.refMonth)/H(e.refMonth),a),!!n&&(n=O(e,n,"years","decades",_,a),!!n&&(n=O(e,n,"decades","centuries",D,a),!!n&&(n=O(e,n,"centuries","millennia",B,a),n))))))))))throw new Error("Fractional unit overflow")}function Ae(e){var a;for(e.milliseconds<0?(a=x(-e.milliseconds/o),e.seconds-=a,e.milliseconds+=a*o):e.milliseconds>=o&&(e.seconds+=t(e.milliseconds/o),e.milliseconds%=o),e.seconds<0?(a=x(-e.seconds/m),e.minutes-=a,e.seconds+=a*m):e.seconds>=m&&(e.minutes+=t(e.seconds/m),e.seconds%=m),e.minutes<0?(a=x(-e.minutes/S),e.hours-=a,e.minutes+=a*S):e.minutes>=S&&(e.hours+=t(e.minutes/S),e.minutes%=S),e.hours<0?(a=x(-e.hours/u),e.days-=a,e.hours+=a*u):e.hours>=u&&(e.days+=t(e.hours/u),e.hours%=u);e.days<0;)e.months--,e.days+=v(e.refMonth,1);e.days>=I&&(e.weeks+=t(e.days/I),e.days%=I),e.months<0?(a=x(-e.months/L),e.years-=a,e.months+=a*L):e.months>=L&&(e.years+=t(e.months/L),e.months%=L),e.years>=_&&(e.decades+=t(e.years/_),e.years%=_,e.decades>=D&&(e.centuries+=t(e.decades/D),e.decades%=D,e.centuries>=B&&(e.millennia+=t(e.centuries/B),e.centuries%=B)))}function Re(e,a,n,r){var i=0;!(a&b)||i>=n?(e.centuries+=e.millennia*B,delete e.millennia):e.millennia&&i++,!(a&g)||i>=n?(e.decades+=e.centuries*D,delete e.centuries):e.centuries&&i++,!(a&f)||i>=n?(e.years+=e.decades*_,delete e.decades):e.decades&&i++,!(a&s)||i>=n?(e.months+=e.years*L,delete e.years):e.years&&i++,!(a&c)||i>=n?(e.months&&(e.days+=v(e.refMonth,e.months)),delete e.months,e.days>=I&&(e.weeks+=t(e.days/I),e.days%=I)):e.months&&i++,!(a&T)||i>=n?(e.days+=e.weeks*I,delete e.weeks):e.weeks&&i++,!(a&y)||i>=n?(e.hours+=e.days*u,delete e.days):e.days&&i++,!(a&p)||i>=n?(e.minutes+=e.hours*S,delete e.hours):e.hours&&i++,!(a&w)||i>=n?(e.seconds+=e.minutes*m,delete e.minutes):e.minutes&&i++,!(a&l)||i>=n?(e.milliseconds+=e.seconds*o,delete e.seconds):e.seconds&&i++,(!(a&E)||i>=n)&&be(e,r)}function le(e,a,n,r,i,M){var P=new Date;if(e.start=a=a||P,e.end=n=n||P,e.units=r,e.value=n.getTime()-a.getTime(),e.value<0){var q=n;n=a,a=q}e.refMonth=new Date(a.getFullYear(),a.getMonth(),15,12,0,0);try{e.millennia=0,e.centuries=0,e.decades=0,e.years=n.getFullYear()-a.getFullYear(),e.months=n.getMonth()-a.getMonth(),e.weeks=0,e.days=n.getDate()-a.getDate(),e.hours=n.getHours()-a.getHours(),e.minutes=n.getMinutes()-a.getMinutes(),e.seconds=n.getSeconds()-a.getSeconds(),e.milliseconds=n.getMilliseconds()-a.getMilliseconds(),Ae(e),Re(e,r,i,M)}finally{delete e.refMonth}return e}function ke(e){return e&E?o/30:e&l?o:e&w?o*m:e&p?o*m*S:e&y?o*m*S*u:o*m*S*u*I}function h(e,a,n,r,i){var M;n=+n||Y,r=r>0?r:NaN,i=i>0?i<20?Math.round(i):20:0;var P=null;typeof e=="function"?(M=e,e=null):e instanceof Date||(e!==null&&isFinite(e)?e=new Date(+e):(typeof P=="object"&&(P=e),e=null));var q=null;if(typeof a=="function"?(M=a,a=null):a instanceof Date||(a!==null&&isFinite(a)?a=new Date(+a):(typeof a=="object"&&(q=a),a=null)),P&&(e=R(P,a)),q&&(a=R(q,e)),!e&&!a)return new V;if(!M)return le(new V,e,a,n,r,i);var Oe=ke(n),ce,fe=function(){M(le(new V,e,a,n,r,i),ce)};return fe(),ce=setInterval(fe,Oe)}h.MILLISECONDS=E,h.SECONDS=l,h.MINUTES=w,h.HOURS=p,h.DAYS=y,h.WEEKS=T,h.MONTHS=c,h.YEARS=s,h.DECADES=f,h.CENTURIES=g,h.MILLENNIA=b,h.DEFAULTS=Y,h.ALL=b|g|f|s|c|T|y|p|w|l|E;var He=h.setFormat=function(e){if(e){if("singular"in e||"plural"in e){var a=e.singular||[];a.split&&(a=a.split("|"));var n=e.plural||[];n.split&&(n=n.split("|"));for(var r=$;r<=te;r++)J[r]=a[r]||J[r],X[r]=n[r]||X[r]}typeof e.last=="string"&&(Q=e.last),typeof e.delim=="string"&&(Z=e.delim),typeof e.empty=="string"&&(ee=e.empty),typeof e.formatNumber=="function"&&(re=e.formatNumber),typeof e.formatter=="function"&&(N=e.formatter)}},se=h.resetFormat=function(){J=" millisecond| second| minute| hour| day| week| month| year| decade| century| millennium".split("|"),X=" milliseconds| seconds| minutes| hours| days| weeks| months| years| decades| centuries| millennia".split("|"),Q=" and ",Z=", ",ee="",re=function(e){return e},N=Me};return h.setLabels=function(e,a,n,r,i,M,P){He({singular:e,plural:a,last:n,delim:r,empty:i,formatNumber:M,formatter:P})},h.resetLabels=se,se(),typeof window.define=="function"&&typeof window.define.amd<"u"&&window.define("countdown",[],function(){return h}),h}()),he}var Qe=Xe();const K=Pe(Qe),Ze=()=>Se("timer-cache",()=>({})),en=Ee({__name:"countdown",props:{tag:{type:String,default:"div"},transform:{type:Function,default:U=>U},date:{type:Date,default:null,validator:U=>U.getTime()>=0},timerCacheId:{type:String,default:null}},setup(U,{expose:E}){const l=Ze(),w=U;let p=null;const y=F({minutes:0,seconds:0}),T=F(Date.now()),c=F(0),s=F(null),f=F(null),g=F(null);function b(){g.value!==null&&(p=K(L=>{y.value=L},new Date(g.value),K.MINUTES|K.SECONDS,2))}function Y(){s.value||(s.value=Date.now(),p!==null&&(clearInterval(p),p=null),g.value!==null&&(f.value=g.value-Date.now()))}function o(){s.value&&(c.value+=Date.now()-s.value,s.value=null,f.value!==null&&(g.value=Date.now()+f.value,f.value=null,b()))}function m(){s.value?o():Y()}const S=G(()=>s.value?s.value-T.value-c.value:Date.now()-T.value-c.value),u=G(()=>s.value?c.value+(Date.now()-s.value):c.value),k=G(()=>w.transform({timespan:y.value,activeTime:S.value,pausedTime:u.value,pause:Y,resume:o,togglePause:m}));function I(){const L=Date.now();let _,D;return s.value?(_=s.value-T.value-c.value,D=c.value+(L-s.value)):(_=L-T.value-c.value,D=c.value),{activeTime:_,pausedTime:D}}return E({togglePause:m,pause:Y,resume:o,getTimerValues:I}),Fe(()=>{l.value.timerCacheId!==w.timerCacheId&&(l.value={timerCacheId:w.timerCacheId,startTime:void 0}),l.value.startTime?(T.value=l.value.startTime,c.value=l.value.pausedTime||c.value,s.value=l.value.pauseStart||s.value,f.value=l.value.remainingMs||f.value,g.value=l.value.endTime||g.value,s.value&&f.value!==null?y.value=K(new Date(0),new Date(f.value),K.MINUTES|K.SECONDS,2):b()):(T.value=Date.now(),w.date&&(g.value=w.date.getTime()),b())}),Ue([T,c,s,f,g],()=>{if(l.value.timerCacheId!==w.timerCacheId){ve(()=>{l.value={timerCacheId:w.timerCacheId}});return}ve(()=>{l.value={timerCacheId:w.timerCacheId,startTime:T.value,pausedTime:c.value,pauseStart:s.value||void 0,remainingMs:f.value||void 0,endTime:g.value||void 0}})},{deep:!0}),Ye(()=>{p!==null&&clearInterval(p)}),(L,_)=>(W(),we(je(U.tag),null,{default:ue(()=>[xe(L.$slots,"default",$e(Ve(k.value)))]),_:3}))}}),nn=()=>Se("routine-run-cache",()=>({})),an={key:0},rn={key:1,class:"page"},on={class:"top-bar"},un={class:"routine-title"},tn={class:"timer-section"},ln={class:"timer-icon"},sn={class:"countdown-timer"},cn={class:"total-duration"},fn={class:"action-buttons"},dn={key:0,class:"next-habit-title"},vn={key:1,class:"next-habit-title"},gn=Ee({__name:"run",async setup(U){let E,l;const w=Ke(),p=w.params.id;if(typeof p!="string")throw[E,l]=ne(()=>z("/")),await E,l(),new Error("wrong routine id");const y=w.params.routineLogId;if(typeof y!="string")throw[E,l]=ne(()=>z("/")),await E,l(),new Error("wrong routine log id");const T=ze(),c=Ge(),s=Je(),f=nn(),g=T.routines,b=T.routinesLoading,Y=c.habitsLoading,o=G(()=>g.value[p]??null);me(()=>{!b.value&&!g.value[p]&&(alert("routine not found, about to navigate to home, if this is a mistake try going back and report the issue!"),z("/"))});const m=(t=new Date)=>{o.value.habitInstances[u.value]!=null&&(k.value=new Date(t),k.value.setSeconds(k.value.getSeconds()+o.value.habitInstances[u.value].durationSec),f.value.RoutineLogId=y,f.value.CurrentIndex=u.value)},S=F(null),u=F(0);let k=F(new Date);if(me(()=>{!b.value&&o.value&&(f.value.RoutineLogId!=null&&f.value.RoutineLogId!=y&&(f.value={}),f.value.CurrentIndex!=null&&(u.value=f.value.CurrentIndex),m())}),!([E,l]=ne(()=>s.getRoutineLog(y)),E=await E,l(),E))throw[E,l]=ne(()=>z("/routines/"+p)),await E,l(),new Error("routine log not found");const L=async t=>{const v=S.value;if(v==null)return;const H=v.getTimerValues();s.createHabitLog(o.value.habitInstances[u.value].habitId,t,H.activeTime/1e3,y),await _()||(u.value++,m())},_=async()=>o.value.habitInstances.length<=u.value+1?(f.value={},await z(`/routines/${p}/logs/${y}/complete`),!0):!1,D=()=>{const t=S.value;t!=null&&t.togglePause()},B=G(()=>!(o.value.habitInstances.length<=u.value+1)),x=t=>{const v={};let H=!1;t.timespan.value!=null&&(H=t.timespan.value<0);const A=t.timespan.minutes||0,R=t.timespan.seconds||0,$=H?`+${A<10?`0${A}`:A}`:A<10?`0${A}`:String(A),ie=R<10?`0${R}`:String(R);return v.minutes=$,v.seconds=ie,v};return(t,v)=>{const H=Be,A=en;return d(b)||d(Y)?(W(),ae("div",an,"Loading...")):(W(),ae("div",rn,[C("div",on,[v[3]||(v[3]=C("div",{class:"placeholder"},null,-1)),We(H,{to:{name:"routines-id",params:{id:d(o).id}},class:"close-button"},{default:ue(()=>v[2]||(v[2]=[qe("X ")])),_:1},8,["to"])]),C("h1",un,j(d(c).habits.value[d(o).habitInstances[d(u)].habitId].title),1),C("div",tn,[C("div",ln,j(d(c).habits.value[d(o).habitInstances[d(u)].habitId].icon),1),(W(),we(A,{date:d(k),transform:x,"allow-negative":!0,key:d(u),timerCacheId:d(y)+"-"+d(u),ref_key:"countdownTimer",ref:S},{default:ue(({minutes:R,seconds:$})=>[C("div",sn,j(R)+":"+j($),1)]),_:1},8,["date","timerCacheId"])),C("div",cn,j(d(o).habitInstances[d(u)].durationSec)+"s",1)]),C("div",fn,[C("button",{class:"action-button pause-button",onClick:D},"⏸️"),C("button",{class:"action-button complete-button",onClick:v[0]||(v[0]=R=>L(("HabitStatus"in t?t.HabitStatus:d(de)).Completed))},"✔️"),C("button",{class:"action-button skip-button",onClick:v[1]||(v[1]=R=>L(("HabitStatus"in t?t.HabitStatus:d(de)).Skipped))},"⏭️")]),d(B)?(W(),ae("h3",dn," Next habit ➡️ "+j(d(c).habits.value[d(o).habitInstances[d(u)+1].habitId].title),1)):(W(),ae("h3",vn,"This is the last one! 🏆")),v[4]||(v[4]=C("div",{class:"footer"}," Additional details can go here. ",-1))]))}}});export{gn as default};
