import{_ as T}from"./BheXkWa9.js";import{m as $,r as _,g as F,c as l,x as w,a as e,A as E,K as P,F as V,u as D,B as O,o as d,t as h,_ as U,D as j,E as q,G,e as K,b as L,w as z,C as c,H as x,d as J}from"./KhMBVH7t.js";import{u as Q}from"./DUMC96Jx.js";import{u as W}from"./DVwyE9wM.js";import{u as X}from"./BnZKFdRb.js";import"./CAFlqnyI.js";const Y={class:"modal-controls"},Z=["value"],tt=$({__name:"attachHabitModal",props:{habits:Object,isEditing:Boolean},emits:["selectionMade","editingChanged"],setup(S,{expose:p,emit:M}){const b=S;if(!b.habits)throw new Error("habits prop is required");const i=_(!1),a=_(""),s=_("");F(a,n=>{if(b.habits&&(console.log("selectedHabit changed:",n),!b.isEditing&&n)){const t=b.habits[n];s.value=t!=null&&t.targetDurationSec?t.targetDurationSec.toString():""}},{immediate:!0});const f=M;function k(){a.value="",s.value=""}function g(){if(!a.value){alert("Please select an option.");return}if(s.value==""||s.value=="0"){alert("Please enter a valid duration.");return}if(s.value==null){alert("Please enter a valid durationx.");return}const n={habitId:a.value,durationSec:parseInt(s.value)};f("selectionMade",n),f("editingChanged",!1),k(),m()}function y(n){n!==void 0?(console.log("edit mode",n.durationSec,n.habitId),a.value=n.habitId,s.value=n.durationSec.toString()):(console.log("add mode",n),a.value="",s.value=""),i.value=!0}function m(){i.value=!1}return p({openModal:y,closeModal:m}),(n,t)=>(d(),l("div",null,[i.value?(d(),l("div",{key:0,class:"modal-overlay",onClick:m})):w("",!0),i.value?(d(),l("div",{class:"modal",key:a.value},[t[3]||(t[3]=e("h2",{class:"modal-title"},"Choose an Option",-1)),e("div",Y,[E(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>a.value=o)},[t[2]||(t[2]=e("option",{value:"",disabled:""},"Select...",-1)),(d(!0),l(V,null,D(b.habits,o=>(d(),l("option",{value:o.id},h(o.icon)+" "+h(o.title),9,Z))),256))],512),[[P,a.value]]),E(e("input",{type:"number",class:"input-field","onUpdate:modelValue":t[1]||(t[1]=o=>s.value=o),placeholder:"override duration seconds"},null,512),[[O,s.value]])]),e("button",{class:"submit-button",onClick:g},"Submit")])):w("",!0)]))}}),et=U(tt,[["__scopeId","data-v-ecd3fde8"]]),at={class:"content"},nt={key:0},ot={key:1,class:"cards-container"},it=["index"],st={class:"card-content"},lt={class:"habit-icon"},dt={class:"habit-title"},ut={class:"habit-duration"},rt={class:"card-actions"},ct=["onClick"],vt=["onClick"],bt={key:2,class:"floating-button"},Mt=$({__name:"index",async setup(S){let p,M;const i=j().params.id;if(typeof i!="string")throw[p,M]=q(()=>x("/")),await p,M(),new Error("wrong routine id, not a string");const a=Q(),s=a.routines,f=a.routinesLoading,k=G(()=>s.value[i]??null);K(()=>{!f.value&&!s.value[i]&&x("/")});const g=W(),y=g.habitsLoading;function m(u){o.value=u}const n=({habitId:u,durationSec:r})=>{o.value&&C.value?a.updateHabitInstance(i,C.value,{habitId:u,durationSec:r}):a.addHabitInstanceToRoutine(i,u,r),o.value=!1},t=_(null),o=_(!1),C=_(void 0);function H(u){t.value?u?(o.value=!0,C.value=u.habitInstanceId,t.value.openModal({habitId:u.habitId,durationSec:u.durationSec})):(o.value=!1,C.value=void 0,t.value.openModal()):console.error("AttachHabitModal is not available yet.")}async function A(){const r=await X().createRoutineLog(i);await x(`/routines/${i}/logs/${r}/run`)}return(u,r)=>{var I;const B=T;return d(),l("div",at,[L(B,{class:"back-button",to:"/"},{default:z(()=>r[1]||(r[1]=[J("üîô")])),_:1}),c(f)||c(y)?(d(),l("div",nt,"Loading...")):(d(),l("div",ot,[e("h1",null,h((I=c(k))==null?void 0:I.title),1),(d(!0),l(V,null,D(c(k).habitInstances,(v,N)=>(d(),l("div",{class:"card",key:v.habitInstanceId,index:N},[e("div",st,[e("span",lt,h(c(g).habits.value[v.habitId].icon),1),e("span",dt,h(c(g).habits.value[v.habitId].title),1),e("span",ut,h(v.durationSec)+"sec",1)]),e("div",rt,[e("span",{class:"action-button edit-button",onClick:R=>H(v)},"üñäÔ∏è",8,ct),e("span",{class:"action-button delete-button",onClick:R=>c(a).removeHabitInstance(c(i),v.habitInstanceId)},"üóëÔ∏è",8,vt)])],8,it))),128)),e("div",{class:"card add-habit-card",onClick:r[0]||(r[0]=v=>H())},r[2]||(r[2]=[e("div",{class:"card-content"},[e("span",{class:"habit-title"},"+ Attach Habit")],-1)]))])),c(f)?(d(),l("div",bt," ‚ñ∂Ô∏è ")):(d(),l("div",{key:3,class:"floating-button",onClick:A}," ‚ñ∂Ô∏è ")),L(et,{habits:c(g).habits.value,isEditing:c(o),ref_key:"attachHabitModal",ref:t,onSelectionMade:n,onEditingChanged:m},null,8,["habits","isEditing"])])}}});export{Mt as default};
